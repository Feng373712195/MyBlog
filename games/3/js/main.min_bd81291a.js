var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,s){function o(e){try{c(i.next(e))}catch(t){s(t)}}function a(e){try{c(i["throw"](e))}catch(t){s(t)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,a)}c((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,s&&(o=s[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,s=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){c.label=n[1];break}if(6===n[0]&&c.label<o[1]){c.label=o[1],o=n;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(n);break}o[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(i){n=[6,i],s=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,s,o,a,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},CommonScene=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.top=0,this.left=0,this.right=0,this.bottom=0},t.prototype.setBackBtn=function(e){var t=new eui.Image;t.source="back_png",t.width=97,t.height=86,t.top=38,this.addChild(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e&&e(),SceneManager.getInstance().popScene()},this)},t.prototype.setBackGround=function(e,t,n){var i=e.width,r=e.height,s=new egret.Shape,o=new egret.Matrix;o.createGradientBox(i,r,.5*Math.PI,0,0),s.graphics.beginGradientFill(egret.GradientType.LINEAR,t,[1,1],[0,255],o),n?s.graphics.drawRoundRect(0,0,i,r,n):s.graphics.drawRect(0,0,i,r),s.graphics.endFill(),e.addChild(s)},t}(eui.Component);__reflect(CommonScene.prototype,"CommonScene",["eui.UIComponent","egret.DisplayObject"]);var Timeout=function(){function e(){this.timer=null,this.time=12}return e.prototype.restTimeout=function(e){clearTimeout(this.timer),this.time=12,e.text=this.time+"S"},e.prototype.startTimeOut=function(e,t,n){var i=this;this.timer=setTimeout(function(){if(0!==i.time){if(e.text=--i.time+"S",t(i.time),0===i.time)return void(n&&n());i.startTimeOut(e,t,n)}},1e3)},e.prototype.stopTimeOut=function(){clearTimeout(this.timer)},e}();__reflect(Timeout.prototype,"Timeout");var ANSWER_SELECT_COLORS=[14416106,16764364],ANSWER_RADIO_COLORS=[1300880,16732494,2342869],TIME_PPROGRESS_COLORS=[2342869,13365493],NUM_MAP={1:"一",2:"二",3:"三",4:"四",5:"五",6:"六"},GAME_QUESTION_NUM=6,CommonGameScene=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.question_answers=[],t.time_progress_block=[],t.isleave=!0,t.Tweens=[],t}return __extends(t,e),t.prototype.init=function(){this.time_progress_block=this.querySelector(this.time_progress,"time_progress_item",!0),this.time_progress_block=this.time_progress_block.reverse()},t.prototype.initAnswerBtn=function(e){void 0===e&&(e=function(e){});for(var t=function(t){var i=n["answer_"+t],r={btn:i,bg:n.querySelector(i,"question_bg"),radiobox:n.querySelector(i,"radio"),radio:n.querySelector(i,"radio_box"),radio_checked:n.querySelector(i,"radio_checked"),icon:[n.querySelector(i,"right_icon"),n.querySelector(i,"error_icon"),n.querySelector(i,"rival_icon")]};n.question_answers.push(r),r.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return e(t-1)},r.btn),r.bg.alpha=0},n=this,i=1;4>=i;i++)t(i)},t.prototype.resetGameScene=function(){this.question_type.alpha=0,this.question_box.alpha=0,this.question_rule.alpha=0,this.question_answer.alpha=0},t.prototype.resetAnswerBtn=function(){this.question_answers.forEach(function(e,t){e.icon.forEach(function(e){return e.visible=!1}),e.radio.fillColor=ANSWER_RADIO_COLORS[2],e.radio_checked.alpha=0,0===e.radiobox.alpha&&(e.radiobox.alpha=1),e.bg.alpha=0})},t.prototype.clearnTween=function(){egret.Tween.removeAllTweens(),this.Tweens.forEach(function(e){return egret.Tween.removeTweens(e)}),this.Tweens.length=0},t.prototype.resetTimeProgress=function(){this.time_progress_block.forEach(function(e){e.fillColor=TIME_PPROGRESS_COLORS[1]})},t.prototype.resetTranstions=function(){this.transtions.visible&&(this.transtions.visible=!1)},t.prototype.onTiemout=function(e){this.time_progress_block[e/3]&&(this.time_progress_block[e/3].fillColor=TIME_PPROGRESS_COLORS[0])},t.prototype.showTranstions=function(e){var t=this;this.transtions.text=e,this.transtions.visible=!0;var n=this.myTween(this.transtions);return new Promise(function(e){n.to({size:60},500,egret.Ease.backInOut).to({alpha:0},500,egret.Ease.backInOut).call(function(){t.transtions.size=40,t.transtions.alpha=1,t.transtions.visible=!1,e()})})},t.prototype.showQuestion=function(){var e=this;return new Promise(function(t){return __awaiter(e,void 0,void 0,function(){var e,n,i,r=this;return __generator(this,function(s){switch(s.label){case 0:e=[this.question_type,this.question_box,this.question_rule,this.question_answer],n=0,i=this.showQuestionAmin(e[n]),s.label=1;case 1:return n===e.length-1?[3,3]:[4,this.myPromise(i.then(function(){return i=r.showQuestionAmin(e[++n])}))];case 2:return s.sent(),[3,1];case 3:return t(),[2]}})})})},t.prototype.showQuestionAmin=function(e){var t=this,n=new Promise(function(n){var i=t.myTween(e);i.to({alpha:1},300,egret.Ease.circIn),i.call(function(){return n()})});return n},t.prototype.hideQuestion=function(){var e=this;return new Promise(function(t){var n=[e.question_type,e.question_box,e.question_rule,e.question_answer];n.forEach(function(t){e.myTween(t).to({alpha:0},500,egret.Ease.circOut)});var i=setTimeout(function(){t(),clearTimeout(i)},500)})},t.prototype.tapAnswerAmin=function(e){var t=this;return new Promise(function(n){var i=t.myTween(e.btn);i.to({scaleX:1.02,scaleY:1.02},200,egret.Ease.backInOut).to({scaleX:1,scaleY:1},200,egret.Ease.backInOut).call(n)})},t.prototype.errorAmin=function(){var e=this,t=this.game_window.x;return new Promise(function(n){var i=e.myTween(e.game_window);i.to({x:t-10},100,egret.Ease.cubicInOut).to({x:t+10},100,egret.Ease.cubicInOut).to({x:t-10},100,egret.Ease.cubicInOut).to({x:t},100,egret.Ease.cubicInOut).call(n)})},t.prototype.querySelector=function(e,t,n){void 0===n&&(n=!1);var i=[],r=e.$children;if(!r.length)return n?[]:void 0;for(var s=0,o=r.length;o>s;s++){if(r[s].name===t){if(!n)return r[s];i.push(r[s])}if(r[s].$children&&r[s].$children.length){var a=this.querySelector(r[s],t,n);if(n)a.length&&i.push.apply(i,a);else if(a)return a}}return n?i:void 0},t.prototype.myPromise=function(e){var t=this;return new Promise(function(n,i){return __awaiter(t,void 0,void 0,function(){var t;return __generator(this,function(r){switch(r.label){case 0:return this.isleave&&i(),[4,e];case 1:return t=r.sent(),this.isleave&&i(),n(t),[2]}})})})},t.prototype.myTween=function(e){var t=this,n=egret.Tween.get(e);return this.Tweens.push(e),n.call(function(){var n=t.Tweens.indexOf(e);t.Tweens.splice(n,1)}),n},t}(CommonScene);__reflect(CommonGameScene.prototype,"CommonGameScene");var MessageBox=function(e){function t(){var t=e.call(this)||this;return t.event={},t}return __extends(t,e),t.prototype.childrenCreated=function(){this.left=0,this.right=0,this.top=0,this.bottom=0,this.messagebox.alpha=0,this.messagebox.scaleX=0,this.messagebox.scaleY=0,this.messagebox.y=document.body.clientHeight,this.messagebox.x=document.body.clientWidth,this.messagebox.anchorOffsetX=.5*this.messagebox.width,this.messagebox.anchorOffsetY=.5*this.messagebox.height,e.prototype.childrenCreated.call(this),this.setBackground(),this.close_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeMessage,this)},t.prototype.setBackground=function(){var e=this.messagebox,t=e.width,n=e.height,i=new eui.Image;i.width=t+20,i.height=n+20,i.x=-10,i.y=-10,i.source="message_bg_png",this.bg.addChild(i)},t.prototype.showMessage=function(){var e=this;return SceneManager.getInstance().pushScene(this),new Promise(function(t){var n=egret.Tween.get(e.messagebox);n.to({alpha:1,scaleX:1,scaleY:1},200,egret.Ease.quartIn).call(function(){return e.emit("onShow")}).call(t)})},t.prototype.closeMessage=function(){var e=this;return new Promise(function(t){var n=egret.Tween.get(e.messagebox);n.to({alpha:0,scaleX:0,scaleY:0},200,egret.Ease.quartOut).call(function(){return e.emit("onClose")}).call(function(){return SceneManager.getInstance().popScene()}).call(t)})},t.prototype.on=function(e,t){this.event[e]||(this.event[e]=[]),this.event[e].push(t)},t.prototype.once=function(e,t){var n=this;this.event[e]||(this.event[e]=[]);var i=function(){t(),n.off(e,i)};this.event[e].push(i)},t.prototype.emit=function(e){this.event[e]&&this.event[e].forEach(function(e){return e()})},t.prototype.off=function(e,t){if(this.event[e]){var n=this.event[e].indexOf(t);this.event[e].splice(n,1)}},t}(eui.Component);__reflect(MessageBox.prototype,"MessageBox",["eui.UIComponent","egret.DisplayObject"]);var PkScene=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.setBackBtn(),this.setBackground(),this.pk_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showPkWait.bind(this,1),this),this.share_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showPkWait.bind(this,2),this)},t.prototype.setBackground=function(){var e=this.stage.stageWidth,t=this.stage.stageHeight,n=new egret.Shape,i=new egret.Matrix;i.createGradientBox(e,t,.5*Math.PI,0,0),n.graphics.beginGradientFill(egret.GradientType.LINEAR,[1495507,7534278],[1,1],[0,255],i),n.graphics.drawRect(0,0,e,t),n.graphics.endFill(),this.bg.addChild(n)},t.prototype.showPkWait=function(e){var t=PkWaitMessageBox.getInstance();t.showMessage(),t.setType(e)},t}(CommonScene);__reflect(PkScene.prototype,"PkScene");var Http;!function(e){function t(e){void 0===e&&(e={});var t=Object.keys(e),n=t.reduce(function(t,n){return t+="&"+n+"="+e[n]},"").slice(1);return n}function n(e,n,i,r,s){var o=this;return void 0===n&&(n={}),void 0===r&&(r=!1),void 0===s&&(s=!0),new Promise(function(i,r){var a=new egret.HttpRequest;a.responseType=egret.HttpResponseType.TEXT,a.open("//httpbin.org"+e,egret.HttpMethod.POST),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");Object.keys(n);s&&(n.token=egret.localStorage.getItem("token"));var c=t(n);a.send(c),a.addEventListener(egret.Event.COMPLETE,function(e){i(e)},o),a.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){r(e)},o)})}function i(e){var t=this;return new Promise(function(n,i){var r=new egret.HttpRequest;r.responseType=egret.HttpResponseType.TEXT,r.open("//httpbin.org"+e,egret.HttpMethod.GET),r.send(),r.addEventListener(egret.Event.COMPLETE,function(e){n(e)},t),r.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){i(e)},t)})}e.PostRequest=n,e.GetRequest=i}(Http||(Http={}));var SceneManager=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.scenes=[],t}return __extends(t,e),t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.changeScene=function(e){this.scenes.length?(this.popScene(),this.pushScene(e)):this.pushScene(e)},t.prototype.pushScene=function(e){this.scenes.push(e),this.rootLayer.addChild(e)},t.prototype.popScene=function(){console.log("after",this.scenes);var e=this.scenes.pop();console.log("before",this.scenes),console.log(e,"=== pop scene ==="),this.rootLayer.removeChild(e)},t}(eui.Component);__reflect(SceneManager.prototype,"SceneManager");var SoundManager=function(){function e(){this.loadSound()}return e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.loadSound=function(){},e}();__reflect(SoundManager.prototype,"SoundManager");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function i(i){t.call(n,i,e)}if(RES.hasRes(e)){var r=RES.getRes(e);r?i(r):RES.getResAsync(e,i,this)}else RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var User=function(){function e(){}return e.type=0,e.key=2,e}();__reflect(User.prototype,"User");var BeginScene=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.left=0,this.right=0,this.top=0,this.bottom=0,this.start_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toStartScence.bind(this.start_btn,!1),this.start_btn),this.nologin_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toStartScence.bind(this.start_btn,!0),this.nologin_btn)},t.prototype.toStartScence=function(e){void 0===e&&(e=!1),e||(User.type=1),SceneManager.getInstance().changeScene(StartScene.getInstance())},t}(eui.Component);__reflect(BeginScene.prototype,"BeginScene",["eui.UIComponent","egret.DisplayObject"]);var ChooseTypeDetailScenen=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.setBackBtn()},t}(CommonScene);__reflect(ChooseTypeDetailScenen.prototype,"ChooseTypeDetailScenen");var ChooseTypeScene=function(e){function t(){var t=e.call(this)||this;return t.sliderIndex=0,t}return __extends(t,e),t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.setBackBtn(),this.type_btn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toChooseTypeDetail,this),this.loopSlider()},t.prototype.loopSlider=function(){var e=this;if(4===this.sliderIndex){this.sliderIndex=0,egret.Tween.removeTweens(this.slider);var t=egret.Tween.get(this.slider);t.to({x:0},0),this.loopSlider()}else setTimeout(function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this["slider_btn"+(this.sliderIndex+1)].fillColor=0,++this.sliderIndex,this["slider_btn"+(4===this.sliderIndex?1:this.sliderIndex+1)].fillColor=16777215,[4,this.translateSlider(this.sliderIndex)];case 1:return e.sent(),this.loopSlider(),[2]}})})},1e3)},t.prototype.translateSlider=function(e){var t=this;return new Promise(function(n){console.log(e,"translateSlider",690*e);var i=egret.Tween.get(t.slider);i.to({x:-(690*e)},500).call(n)})},t.prototype.toChooseTypeDetail=function(){SceneManager.getInstance().pushScene(ChooseTypeDetailScenen.getInstance())},t}(CommonScene);__reflect(ChooseTypeScene.prototype,"ChooseTypeScene");var GameTimeout=new Timeout,GameScene=function(e){function t(){var t=e.call(this)||this;return t.current_quetion_index=1,t.player_selected=!1,t}return __extends(t,e),t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.setBackBtn(function(){t.reset.bind(t)(0),t.isleave=!0}),this.init()},t.prototype.init=function(){e.prototype.init.call(this),this.initAnswerBtn(this.selectAnswer.bind(this)),this.resetGameScene(),this.usekey_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.useKey,this)},t.prototype.reset=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.current_quetion_index=e,this.clearnTween(),this.resetTranstions(),[4,this.hideQuestion()];case 1:return t.sent(),GameTimeout.restTimeout(this.timeout),this.resetTimeProgress(),this.player_selected=!1,this.resetGameScene(),this.resetAnswerBtn(),this.question_index.text=e+"/"+GAME_QUESTION_NUM,[2]}})})},t.prototype.startGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.isleave=!1,[4,this.myPromise(this.reset(1))];case 1:return e.sent(),[4,this.myPromise(this.showTranstions("开始"))];case 2:return e.sent(),[4,this.myPromise(this.showQuestion())];case 3:return e.sent(),GameTimeout.startTimeOut(this.timeout,this.onTiemout.bind(this),this.timeoutHandle.bind(this)),[2]}})})},t.prototype.showAnswerStateAmin=function(e,t){var n=this,i=0===t?0:1;return e.radio.fillColor=ANSWER_RADIO_COLORS[i],e.radio_checked.fillColor=ANSWER_RADIO_COLORS[i],e.bg.fillColor=ANSWER_SELECT_COLORS[i],e.icon[i].visible=!0,new Promise(function(t){var i=n.myTween(e.radio_checked);i.to({alpha:1},100,egret.Ease.backInOut);var r=n.myTween(e.bg);r.to({alpha:1},100,egret.Ease.circIn).call(t)})},t.prototype.useKey=function(){var e=this;UseKeyMessageBox.getInstance().showMessage(),UseKeyMessageBox.getInstance().once("onClose",function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){return this.showNextQuestion(),[2]})})})},t.prototype.selectAnswer=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,i=this;return __generator(this,function(r){switch(r.label){case 0:return this.player_selected?[2]:(this.player_selected=!0,t=this.question_answers[e],[4,this.tapAnswerAmin(t)]);case 1:return r.sent(),[4,this.checkAnswer(t,e)];case 2:return n=r.sent(),GameTimeout.stopTimeOut(),ResultMessageBox.getInstance().showMessage(),ResultMessageBox.getInstance().setSate(n),ResultMessageBox.getInstance().once("onClose",function(){return __awaiter(i,void 0,void 0,function(){return __generator(this,function(e){return this.showNextQuestion(),[2]})})}),[2]}})})},t.prototype.checkAnswer=function(e,t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(i){switch(i.label){case 0:return n=0!==t?!1:!0,n?[3,2]:[4,this.errorAmin()];case 1:i.sent(),i.label=2;case 2:return[4,this.showAnswerStateAmin(e,t)];case 3:return i.sent(),[2,n]}})})},t.prototype.checkIsNext=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},t.prototype.showNextQuestion=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.current_quetion_index===GAME_QUESTION_NUM?(this.finishGame(),[2]):[4,this.myPromise(this.reset(this.current_quetion_index+1))];case 1:return e.sent(),[4,this.myPromise(this.showTranstions(this.current_quetion_index===GAME_QUESTION_NUM?"最后一题":"第"+NUM_MAP[this.current_quetion_index]+"题"))];case 2:return e.sent(),[4,this.myPromise(this.showQuestion())];case 3:return e.sent(),GameTimeout.startTimeOut(this.timeout,this.onTiemout.bind(this),this.timeoutHandle.bind(this)),[2]}})})},t.prototype.finishGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return GameTimeout.stopTimeOut(),[4,this.myPromise(this.hideQuestion())];case 1:return e.sent(),[4,this.myPromise(this.showTranstions("答题结束"))];case 2:return e.sent(),SceneManager.getInstance().changeScene(RankingResultScene.getInstance()),[2]}})})},t.prototype.timeoutHandle=function(){var e=this;ResultMessageBox.getInstance().showMessage(),ResultMessageBox.getInstance().setSate(0),ResultMessageBox.getInstance().once("onClose",function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){return this.showNextQuestion(),[2]})})})},t}(CommonGameScene);__reflect(GameScene.prototype,"GameScene");var NoKeyMessageBox=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(MessageBox);__reflect(NoKeyMessageBox.prototype,"NoKeyMessageBox");var ResultMessageBox=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.setSate=function(e){this.tip_text1.visible=e?!0:!1,this.tip_text2.visible=e?!1:!0},t}(MessageBox);__reflect(ResultMessageBox.prototype,"ResultMessageBox");var UseKeyMessageBox=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(MessageBox);__reflect(UseKeyMessageBox.prototype,"UseKeyMessageBox");var PKGameTimeout=new Timeout,PkGameScene=function(e){function t(){var t=e.call(this)||this;return t.current_quetion_index=1,t.player_selected=!1,t.selected_num=0,t.player_selected_index=-1,t.player_right_count=0,t.rival_selected_index=-1,t.rival_right_count=0,t}return __extends(t,e),t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.setBackBtn(function(){t.reset.bind(t)(0),t.isleave=!0}),this.init()},t.prototype.init=function(){e.prototype.init.call(this),this.initAnswerBtn(this.selectAnswer.bind(this)),this.resetGameScene(),this.score_process=this.querySelector(this.gamer_top,"score_process",!0),console.log(this.score_process,"this.score_process");var t=(this.querySelector(this.gamer_top,"avater_img",!0),this.querySelector(this.gamer_top,"avater_bg",!0));this.setBackGround(t[0],[8715956,3987919],20),this.setBackGround(t[1],[15925305,3701746],20)},t.prototype.reset=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.current_quetion_index=e,this.clearnTween(),this.resetTranstions(),[4,this.hideQuestion()];case 1:return t.sent(),this.resetGamerSelectedState,PKGameTimeout.restTimeout(this.timeout),this.resetTimeProgress(),this.player_selected=!1,this.resetGameScene(),this.resetAnswerBtn(),this.question_index.text=e+"/"+GAME_QUESTION_NUM,[2]}})})},t.prototype.resetGamerSelectedState=function(){this.selected_num=0,this.player_selected_index=-1,this.rival_selected_index=-1},t.prototype.startGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.isleave=!1,[4,this.myPromise(this.reset(1))];case 1:return e.sent(),[4,this.myPromise(this.showTranstions("开始"))];case 2:return e.sent(),[4,this.myPromise(this.showQuestion())];case 3:return e.sent(),this.AI(this.selectAnswer),PKGameTimeout.startTimeOut(this.timeout,this.onTiemout.bind(this),this.timeoutHandle.bind(this)),[2]}})})},t.prototype.showAnswerStateAmin=function(e,t){var n=this,i=0===t?0:1;return e.radio.fillColor=ANSWER_RADIO_COLORS[i],e.radio_checked.fillColor=ANSWER_RADIO_COLORS[i],e.bg.fillColor=ANSWER_SELECT_COLORS[i],e.icon[i].visible=!0,new Promise(function(t){var i=n.myTween(e.radio_checked);i.to({alpha:1},100,egret.Ease.backInOut);var r=n.myTween(e.bg);r.to({alpha:1},100,egret.Ease.circIn).call(t)})},t.prototype.AI=function(e){var t=this,n=Math.floor(4*Math.random()),i=Math.floor(6*Math.random()),r=setTimeout(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){return e.call(this,n,"ai"),clearTimeout(r),[2]})})},1e3*i)},t.prototype.selectAnswer=function(e,t){return void 0===t&&(t="player"),__awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(i){switch(i.label){case 0:return"player"==t&&this.player_selected?[2,!1]:(++this.selected_num,"player"==t&&(this.player_selected=!0),this[("player"==t?"player":"rival")+"_selected_index"]=e,n=this.question_answers[e],[4,this.tapAnswerAmin(n)]);case 1:return i.sent(),this.setAnswerSelected(e,t),[4,this.checkIsNext()];case 2:return i.sent(),[2]}})})},t.prototype.setAnswerSelected=function(e,t){console.log(e,t,"index,from");var n=this.question_answers[e];"player"===t&&(n.radio_checked.visible=!0,n.radio_checked.alpha=1),"ai"===t&&(n.icon[2].visible=!0,n.icon[2].alpha=1)},t.prototype.checkIsNext=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return 2!==this.selected_num?[3,2]:[4,this.checkAnswer()];case 1:if(e.sent(),this.selected_num=0,this.current_quetion_index===GAME_QUESTION_NUM)return this.finishGame(),[2];this.showNextQuestion(),e.label=2;case 2:return[2]}})})},t.prototype.checkAnswer=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n=this;return __generator(this,function(i){return e=0,t=[this.player_selected_index,this.rival_selected_index],t.forEach(function(t,i){n.setAnswerState(t===e?0:1,t,0===i?"player":"ai")}),[2,this.wait(1500)]})})},t.prototype.setAnswerState=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var i,r=this;return __generator(this,function(s){return i=this.question_answers[t],i.bg.fillColor=ANSWER_SELECT_COLORS[e],i.bg.visible=!0,i.icon[e].visible=!0,i.radiobox.alpha=0,"player"===n&&(1===e?this.errorAmin():++this.player_right_count),"ai"===n&&0===e&&++this.rival_right_count,this.checkScoreProcess(),[2,new Promise(function(t){var n=r.myTween(i.icon[e]);n.to({alpha:1},100,egret.Ease.backInOut);var s=r.myTween(i.bg);s.to({alpha:1},100,egret.Ease.circIn).call(t)})]})})},t.prototype.checkScoreProcess=function(){var e=this;this.score_process.forEach(function(t,n){var i=e.myTween(t);i.to({width:190/GAME_QUESTION_NUM*e[(0===n?"player":"rival")+"_right_count"]},500,egret.Ease.elasticIn)})},t.prototype.showNextQuestion=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.current_quetion_index===GAME_QUESTION_NUM?(this.finishGame(),[2]):[4,this.myPromise(this.reset(this.current_quetion_index+1))];case 1:return e.sent(),[4,this.myPromise(this.showTranstions(this.current_quetion_index===GAME_QUESTION_NUM?"最后一题":"第"+NUM_MAP[this.current_quetion_index]+"题"))];case 2:return e.sent(),[4,this.myPromise(this.showQuestion())];case 3:return e.sent(),PKGameTimeout.startTimeOut(this.timeout,this.onTiemout.bind(this),this.timeoutHandle.bind(this)),this.AI.call(this,this.selectAnswer),[2]}})})},t.prototype.finishGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return PKGameTimeout.stopTimeOut(),[4,this.myPromise(this.hideQuestion())];case 1:return e.sent(),[4,this.myPromise(this.showTranstions("答题结束"))];case 2:return e.sent(),SceneManager.getInstance().changeScene(PkResultScene.getInstance()),[2]}})})},t.prototype.timeoutHandle=function(){this.selectAnswer(1,"auto")},t.prototype.wait=function(e){return new Promise(function(t){var n=setTimeout(function(){clearTimeout(n),t()},e)})},t}(CommonGameScene);__reflect(PkGameScene.prototype,"PkGameScene");var PkResultScene=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.setBackground(),this.back_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SceneManager.getInstance().changeScene(StartScene.getInstance())},this),this.play_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SceneManager.getInstance().changeScene(GameScene.getInstance()),PkGameScene.getInstance().startGame()},this)},t.prototype.setBackground=function(){var e=this.stage.stageWidth,t=this.stage.stageHeight,n=new egret.Shape,i=new egret.Matrix;i.createGradientBox(e,t,.5*Math.PI,0,0),n.graphics.beginGradientFill(egret.GradientType.LINEAR,[1495507,7534278],[1,1],[0,255],i),n.graphics.drawRect(0,0,e,t),n.graphics.endFill(),this.bg.addChild(n)},t}(CommonScene);__reflect(PkResultScene.prototype,"PkResultScene");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.skinName="resource/game_skins/Loading.exml",t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.left=0,this.right=0,this.top=0,this.bottom=0},t.prototype.createView=function(){},t.prototype.onProgress=function(e,t){var n=e/t;this.progress.value=100*n},t}(eui.Component);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var matchingState={type:1,state:1,tip:"一大波儿对手正在赶来...",waittip:"已等待中:",rival:"WHO",btnState:0,nextState:function(){return matchrResolveState}},matchrResolveState={type:1,state:2,tip:"匹配成功，对手未就绪...",waittip:"倒计时:",rival:"蜗牛",btnState:2,nextState:function(){return matchrReadyState}},matchrReadyState={type:1,state:3,tip:"对手已就绪",waittip:"倒计时:",rival:"蜗牛",btnState:2,nextState:function(){return!1}},waitFirendsState={type:2,state:1,tip:"等待好友加入",rival:"WHO",btnState:0,nextState:function(){return waitFirendsResolveState}},waitFirendsResolveState={type:2,state:2,tip:"好友已加入",rival:"蜗牛",btnState:1,nextState:function(){return!1}},State=function(){function e(){}return e.changeState=function(){if(e.nextState&&(e.currentState=e.nextState),e.currentState){e.handle(e.currentState);var t=e.currentState.nextState();e.nextState=t?t:null}},e.currentState=null,e.nextState=null,e.handle=null,e}();__reflect(State.prototype,"State");var PkWaitTImer=function(){function e(){this.timer=null,this.time=10}return e.prototype.restTimeout=function(e){clearTimeout(this.timer),this.time=10,e.text=this.time+"秒"},e.prototype.startTimeOut=function(e,t){var n=this;this.timer=setTimeout(function(){if(0!==n.time){if(e.text=--n.time+"秒",0===n.time)return void(t&&t());n.startTimeOut(e,t)}},1e3)},e.prototype.stopTimeOut=function(){clearTimeout(this.timer)},e}();__reflect(PkWaitTImer.prototype,"PkWaitTImer");var pkWaitTimer=new PkWaitTImer,PkWaitMessageBox=function(e){function t(){var t=e.call(this)||this;return t.wait_time=0,t}return __extends(t,e),t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.game_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startGame,this),State.handle=this.changeState.bind(this)},t.prototype.changeState=function(e){var t=e.tip,n=e.rival,i=e.waittip,r=e.btnState,s=e.type;i&&(this.wait_time_tip.text=i);var o=this.querySelector(1===s?this.match_tip:this.join_tip,"tip");o.text=t,this.rival_name.text=n;var a=this.querySelector(this.game_btn,"bg");1===s&&1===e.state&&this.startCountMatchTime(),1===s&&2===e.state?(this.ready_mask.visible=!0,a.source=RES.getRes("btn_bg6_png"),clearInterval(this.count_timer),this.wait_time_text.text="10秒",pkWaitTimer.startTimeOut(this.wait_time_text,this.waitTimeout.bind(this))):(this.ready_mask.visible=!1,a.source=RES.getRes("btn_bg5_png")),this.close_btn.visible=0===r?!0:!1,this.game_btn.visible=0===r?!1:!0
},t.prototype.waitTimeout=function(){pkWaitTimer.stopTimeOut(),pkWaitTimer.restTimeout(this.wait_time_text),State.currentState=matchingState,State.changeState()},t.prototype.setType=function(e){var t=this;this.match_tip.visible=1===e?!0:!1,this.join_tip.visible=1===e?!1:!0,this.state_timer=setInterval(function(){State.changeState()},4e3),1===e&&(this.once("onShow",function(){State.currentState=1===e?matchingState:waitFirendsState,State.changeState()}),this.once("onClose",function(){clearInterval(t.count_timer),clearInterval(t.state_timer),pkWaitTimer.stopTimeOut(),State.currentState=null,State.nextState=null}))},t.prototype.startCountMatchTime=function(){var e=this;this.wait_time_text.text=(this.wait_time=0)+"秒",this.count_timer=setInterval(function(){e.wait_time_text.text=++e.wait_time+"秒"},1e3)},t.prototype.querySelector=function(e,t,n){void 0===n&&(n=!1);var i=[],r=e.$children;if(!r.length)return n?[]:void 0;for(var s=0,o=r.length;o>s;s++){if(r[s].name===t){if(!n)return r[s];i.push(r[s])}if(r[s].$children&&r[s].$children.length){var a=this.querySelector(r[s],t,n);if(n)a.length&&i.push.apply(i,a);else if(a)return a}}return n?i:void 0},t.prototype.startGame=function(){if(State.currentState){var e=State.currentState,t=e.type,n=e.state;if(1===t&&2===n)return;State.currentState=null}this.closeMessage(),setTimeout(function(){SceneManager.getInstance().pushScene(PkGameScene.getInstance()),PkGameScene.getInstance().startGame()},300)},t}(MessageBox);__reflect(PkWaitMessageBox.prototype,"PkWaitMessageBox");var RankingItem=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toGameScene,this)},t.prototype.dataChanged=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];2!==this.data.index?this.item_mask.visible=!0:this.item_mask.visible=!1,1==this.data.index&&(this.pass.visible=!0,this.nopass.visible=!1),this.data.index>2&&(this.nopass.visible=!0,this.pass.visible=!1)},t.prototype.toGameScene=function(){SceneManager.getInstance().pushScene(GameScene.getInstance()),GameScene.getInstance().startGame()},t}(eui.ItemRenderer);__reflect(RankingItem.prototype,"RankingItem");var RankingListScene=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.setBackground(),this.setBackBtn(),this.loadRankingListView()},t.prototype.setBackground=function(){var e=this.stage.stageWidth,t=this.stage.stageHeight,n=new egret.Shape,i=new egret.Matrix;i.createGradientBox(e,t,.5*Math.PI,0,0),n.graphics.beginGradientFill(egret.GradientType.LINEAR,[1495507,7534278],[1,1],[0,255],i),n.graphics.drawRect(0,0,e,t),n.graphics.endFill(),this.bg.addChild(n)},t.prototype.getRankingData=function(e){return new Promise(function(t){for(var n=[],i=1;e>i;i++)n.push({index:i});setTimeout(function(){t(n)},0)})},t.prototype.loadRankingListView=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,i,r;return __generator(this,function(s){switch(s.label){case 0:return e=this.ranking_view,[4,this.getRankingData(20)];case 1:return t=s.sent(),n=new eui.ArrayCollection(t),i=new eui.DataGroup,r=new eui.VerticalLayout,r.gap=30,i.layout=r,i.dataProvider=n,i.percentWidth=100,i.percentHeight=100,i.itemRenderer=RankingItem,i.useVirtualLayout=!0,e.viewport=i,[2]}})})},t}(CommonScene);__reflect(RankingListScene.prototype,"RankingListScene");var RankingResultScene=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.setBackground(),this.back_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SceneManager.getInstance().changeScene(StartScene.getInstance())},this),this.play_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SceneManager.getInstance().changeScene(GameScene.getInstance()),GameScene.getInstance().startGame()},this)},t.prototype.setBackground=function(){var e=750,t=1334,n=new egret.Shape,i=new egret.Matrix;i.createGradientBox(e,t,.5*Math.PI,0,0),n.graphics.beginGradientFill(egret.GradientType.LINEAR,[1495507,7534278],[1,1],[0,255],i),n.graphics.drawRect(0,0,e,t),n.graphics.endFill(),this.bg.addChild(n)},t}(CommonScene);__reflect(RankingResultScene.prototype,"RankingResultScene");var RankItem=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.dataChanged=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.data.isloading&&(this.item_name_label.text="加载中"),1==this.data.rank&&(this.item_group.percentWidth=100),2==this.data.rank&&(this.item_group.percentWidth=98),3==this.data.rank&&(this.item_group.percentWidth=96),this.data.rank>3&&(this.item_group.percentWidth=94)},t}(eui.ItemRenderer);__reflect(RankItem.prototype,"RankItem");var RANKLIST_NUM=2,RankList=function(){function e(){this.list=[],this.data=null,this.load=!1}return e}();__reflect(RankList.prototype,"RankList",["RankList"]);var RankScene=function(e){function t(){var t=e.call(this)||this;return t.current_show_rank=null,t.rank1_list=new RankList,t.rank2_list=new RankList,t.isloading=!1,t}return __extends(t,e),t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){return __awaiter(this,void 0,void 0,function(){var t,n,i,r,s;return __generator(this,function(o){switch(o.label){case 0:for(e.prototype.childrenCreated.call(this),this.setBackBtn(),t=1;RANKLIST_NUM>=t;t++)this["tab"+t+"_btn"].addEventListener(egret.TouchEvent.TOUCH_TAP,this.selectBtn.bind(this,t),this);return this.loadRankListView(1),r=(i=eui.ArrayCollection).bind,[4,this.getRankData(1,1)];case 1:return n=new(r.apply(i,[void 0,o.sent()])),s=new eui.DataGroup,s.dataProvider=n,s.percentWidth=100,s.percentWidth=100,s.itemRenderer=RankItem,console.log("set self rank"),this.self_rank.addChild(s),[2]}})})},t.prototype.getRankData=function(e,t){return console.log("getRankData",t),new Promise(function(n){for(var i=[],r=1;e>=r;r++)i.push({rank:r,name:t?t:"测试用户",score:1e3});setTimeout(function(){n(i)},0)})},t.prototype.loadRankListView=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,i,r,s;return __generator(this,function(o){switch(o.label){case 0:return t=this["rank"+e+"_view"],n=this["rank"+e+"_list"],n.load?(this.setShowRankView(t,n.data,n.list,e),[2]):(this.showLoading(!0),[4,this.getRankData(20,e)]);case 1:return i=o.sent(),n.load=!0,r=new eui.ArrayCollection(i),n.data=r,s=new eui.DataGroup,s.dataProvider=r,s.percentWidth=100,s.percentHeight=100,s.itemRenderer=RankItem,s.useVirtualLayout=!0,n.list=s,this.showLoading(!1),this.setShowRankView(t,r,s,e),[2]}})})},t.prototype.setShowRankView=function(e,t,n,i){this.current_show_rank&&(this.current_show_rank.view.visible=!1),this.current_show_rank={view:e,data:t,index:i},this.current_show_rank.view.visible=!0,e.viewport=n},t.prototype.selectBtn=function(e){if(!this.isloading&&!this.isloading){var t=this.current_show_rank.index;console.log(this["tab"+t+"_btn"].getChildAt(0),this["tab"+e+"_btn"].getChildAt(0)),this["tab"+t+"_btn"].getChildAt(0).fillColor=TAB_BTN_COLORS[1],this["tab"+e+"_btn"].getChildAt(0).fillColor=TAB_BTN_COLORS[0],this.loadRankListView(e)}},t.prototype.showLoading=function(e){this.current_show_rank&&(this.current_show_rank.view.visible=!1),this.isloading=e,this.loading.visible=e},t.prototype.pullDownLoad=function(e){var t=this["rank"+e+"_view"],n=t.viewport,i=n.scrollV,r=n.contentHeight,s=n.height;if(i+s===r){console.log("scroll bottom");var o=new eui.Label;o.text="加载中",this.current_show_rank.data.addItem({isloading:!0})}console.log("=== scroll end ===")},t}(CommonScene);__reflect(RankScene.prototype,"RankScene");var BuySuccessMessage=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(MessageBox);__reflect(BuySuccessMessage.prototype,"BuySuccessMessage");var ExchangeItem=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.exchange_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showExchangeMessage,this)},t.prototype.showExchangeMessage=function(){ExchangeSuccesMessage.getInstance().showMessage()},t}(eui.ItemRenderer);__reflect(ExchangeItem.prototype,"ExchangeItem");var ExchangeSuccesMessage=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(MessageBox);__reflect(ExchangeSuccesMessage.prototype,"ExchangeSuccesMessage");var ShoppingItem=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.buy_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showBuyMessage,this)},t.prototype.showBuyMessage=function(){BuySuccessMessage.getInstance().showMessage()},t}(eui.ItemRenderer);__reflect(ShoppingItem.prototype,"ShoppingItem");var SHOPPING_TAB_NUM=2,TAB_BTN_COLORS=[9588976,12094968],DataList=function(){function e(){this.list=[],this.data=null,this.load=!1}return e}();__reflect(DataList.prototype,"DataList",["DataList"]);var ShoppingMallScene=function(e){function t(){var t=e.call(this)||this;return t.current_show_tab=null,t.shopping1_list=new DataList,t.shopping2_list=new DataList,t.isloading=!1,t}return __extends(t,e),t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.setBackBtn(),this.setBackground();for(var t=1;SHOPPING_TAB_NUM>=t;t++)this["tab"+t+"_btn"].addEventListener(egret.TouchEvent.TOUCH_TAP,this.selectBtn.bind(this,t),this);this.loadShoppingListView(1)},t.prototype.getShoppingListData=function(e,t){return console.log("getRankData",t),new Promise(function(n){for(var i=[],r=1;e>r;r++)i.push({rank:r,name:t?t:"测试用户",score:1e3});setTimeout(function(){n(i)},0)})},t.prototype.loadShoppingListView=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,i,r,s,o;return __generator(this,function(a){switch(a.label){case 0:return t=this["shopping"+e+"_view"],n=this["shopping"+e+"_list"],n.load?(this.setShowTabView(t,n.data,n.list,e),[2]):(i=[ShoppingItem,ExchangeItem],this.showLoading(!0),[4,this.getShoppingListData(20,e)]);case 1:return r=a.sent(),n.load=!0,s=new eui.ArrayCollection(r),n.data=s,o=new eui.DataGroup,o.dataProvider=s,o.percentWidth=100,o.percentHeight=100,o.itemRenderer=i[e-1],o.useVirtualLayout=!0,n.list=o,this.showLoading(!1),this.setShowTabView(t,s,o,e),[2]}})})},t.prototype.setShowTabView=function(e,t,n,i){this.current_show_tab&&(this.current_show_tab.view.visible=!1),this.current_show_tab={view:e,data:t,index:i},this.current_show_tab.view.visible=!0,e.viewport=n},t.prototype.selectBtn=function(e){if(!this.isloading){var t=this.current_show_tab.index;console.log(this["tab"+t+"_btn"].getChildAt(0),this["tab"+e+"_btn"].getChildAt(0)),this["tab"+t+"_btn"].getChildAt(0).fillColor=TAB_BTN_COLORS[1],this["tab"+e+"_btn"].getChildAt(0).fillColor=TAB_BTN_COLORS[0],this.loadShoppingListView(e)}},t.prototype.showLoading=function(e){this.current_show_tab&&(this.current_show_tab.view.visible=!1),this.isloading=e,this.loading.visible=e},t.prototype.setBackground=function(){var e=this.stage.stageWidth,t=this.stage.stageHeight,n=new egret.Shape,i=new egret.Matrix;i.createGradientBox(e,t,.5*Math.PI,0,0),n.graphics.beginGradientFill(egret.GradientType.LINEAR,[1495507,7534278],[1,1],[0,255],i),n.graphics.drawRect(0,0,e,t),n.graphics.endFill(),this.bg.addChild(n)},t}(CommonScene);__reflect(ShoppingMallScene.prototype,"ShoppingMallScene");var LevelUpMessageBox=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.left=0,this.right=0,this.top=0,this.bottom=0},t}(MessageBox);__reflect(LevelUpMessageBox.prototype,"LevelUpMessageBox");var LoginInMessageBox=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(MessageBox);__reflect(LoginInMessageBox.prototype,"LoginInMessageBox");var StartScene=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){0===User.type&&(this.menu_item_4.visible=!1,this.menu_warp.scrollPolicyV="off"),e.prototype.childrenCreated.call(this),LoginInMessageBox.getInstance().showMessage();var t=new eui.HorizontalLayout;t.horizontalAlign=egret.HorizontalAlign.JUSTIFY,this.bottom_nav.layout=t,this.menu_item_1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toRankingList,this),this.menu_item_2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toPK,this),this.menu_item_3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toYB,this),this.bottom_nav_1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toRank,this),this.bottom_nav_2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toShoppingMail,this),this.bottom_nav_3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toShoppingMail,this),this.bottom_nav_4.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toShoppingMail,this)},t.prototype.toRankingList=function(){SceneManager.getInstance().pushScene(RankingListScene.getInstance())},t.prototype.toYB=function(){SceneManager.getInstance().pushScene(ChooseTypeScene.getInstance())},t.prototype.toPK=function(){SceneManager.getInstance().pushScene(PkScene.getInstance())},t.prototype.toShoppingMail=function(){SceneManager.getInstance().pushScene(ShoppingMallScene.getInstance())},t.prototype.toRank=function(){SceneManager.getInstance().pushScene(RankScene.getInstance())},t}(CommonScene);__reflect(StartScene.prototype,"StartScene");var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadResource()];case 1:return n.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return e=n.sent(),[4,platform.login()];case 3:return n.sent(),[4,platform.getUserInfo()];case 4:return t=n.sent(),console.log(t),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,this.loadTheme()];case 2:return n.sent(),e=new LoadingUI,this.addChild(e),[4,RES.loadGroup("preload",0,e)];case 3:return n.sent(),this.removeChild(e),[3,5];case 4:return t=n.sent(),console.error(t),[3,5];case 5:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,n){var i=new eui.Theme("resource/default.thm.json",e.stage);i.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return SceneManager.getInstance().rootLayer=this,SceneManager.getInstance().changeScene(BeginScene.getInstance()),[2]})})},t}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,i){function r(e){t.call(i,e)}function s(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),n.call(i))}var o=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(i,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,n){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(i,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var a=e.split("/");a.pop();var c=a.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(i,generateJSON.paths[e])},this):RES.getResByUrl(c,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){t.call(i,generateJSON.paths[e])},o)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(i,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var WxSDK=function(){function e(){var e=new BodyConfig;e.appId="此处填写公共平台appID，未认证的ID将不能使用自定义分享等接口，请联系微信官方获取",e.debug=!0,e.jsApiList=["checkJsApi","onMenuShareAppMessage","onMenuShareTimeline"],wx&&(wx.config(e),wx.ready(function(){var e="",t="",n=location.href,i=new BodyMenuShareAppMessage;i.title=e,i.desc=t,i.link=n,wx.onMenuShareTimeline(i);var r=new BodyMenuShareTimeline;r.title=e,r.link=n,wx.onMenuShareTimeline(r)}))}return e.prototype.getWxConfig=function(){},e}();__reflect(WxSDK.prototype,"WxSDK");