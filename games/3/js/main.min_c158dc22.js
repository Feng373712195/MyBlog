var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},__awaiter=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(e){s(e)}}function a(t){try{c(r["throw"](t))}catch(e){s(e)}}function c(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(o,a)}c((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,s&&(o=s[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,s=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){c.label=n[1];break}if(6===n[0]&&c.label<o[1]){c.label=o[1],o=n;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(n);break}o[2]&&c.ops.pop(),c.trys.pop();continue}n=e.call(t,c)}catch(r){n=[6,r],s=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,s,o,a,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},__assign=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;r>n;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},CommonScene=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.top=0,this.left=0,this.right=0,this.bottom=0},e.prototype.setBackBtn=function(t){var e=new eui.Image;e.source="back_png",e.width=97,e.height=86,e.top=38,this.addChild(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t&&t(),SceneManager.getInstance().popScene()},this)},e.prototype.setBackGround=function(t,e,n){var r=t.width,i=t.height,s=new egret.Shape,o=new egret.Matrix;o.createGradientBox(r,i,.5*Math.PI,0,0),s.graphics.beginGradientFill(egret.GradientType.LINEAR,e,[1,1],[0,255],o),n?s.graphics.drawRoundRect(0,0,r,i,n):s.graphics.drawRect(0,0,r,i),s.graphics.endFill(),t.addChild(s)},e}(eui.Component);__reflect(CommonScene.prototype,"CommonScene",["eui.UIComponent","egret.DisplayObject"]);var Timeout=function(){function t(){this.timer=null,this.time=12}return t.prototype.restTimeout=function(t){clearTimeout(this.timer),this.time=12,t.text=this.time+"S"},t.prototype.startTimeOut=function(t,e,n){var r=this;this.timer=setTimeout(function(){if(0!==r.time){if(t.text=--r.time+"S",e(r.time),0===r.time)return void(n&&n());r.startTimeOut(t,e,n)}},1e3)},t.prototype.stopTimeOut=function(){clearTimeout(this.timer)},t}();__reflect(Timeout.prototype,"Timeout");var ANSWER_SELECT_COLORS=[14416106,16764364],ANSWER_RADIO_COLORS=[1300880,16732494,2342869],TIME_PPROGRESS_COLORS=[2342869,13365493],NUM_MAP=["一","二","三","四","五","六"],CommonGameScene=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.question_answers=[],e.questions_num=0,e.questions=[],e.time_progress_block=[],e.isleave=!0,e.Tweens=[],e}return __extends(e,t),e.prototype.init=function(){this.time_progress_block=this.querySelector(this.time_progress,"time_progress_item",!0),this.time_progress_block=this.time_progress_block.reverse()},e.prototype.setQuestions=function(t){this.questions_num=t.length,this.questions=t},e.prototype.initAnswerBtn=function(t){void 0===t&&(t=function(t){});for(var e=function(e){var r=n["answer_"+e],i={btn:r,bg:n.querySelector(r,"question_bg"),radiobox:n.querySelector(r,"radio"),radio:n.querySelector(r,"radio_box"),radio_checked:n.querySelector(r,"radio_checked"),text:n.querySelector(r,"answer_text"),icon:[n.querySelector(r,"right_icon"),n.querySelector(r,"error_icon"),n.querySelector(r,"rival_icon")]};n.question_answers.push(i),i.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return t(e-1)},i.btn),i.bg.alpha=0},n=this,r=1;4>=r;r++)e(r)},e.prototype.resetGameScene=function(){this.question_type.alpha=0,this.question_box.alpha=0,this.question_rule.alpha=0,this.question_answer.alpha=0},e.prototype.resetAnswerBtn=function(){this.question_answers.forEach(function(t,e){t.icon.forEach(function(t){return t&&(t.visible=!1)}),t.radio.fillColor=ANSWER_RADIO_COLORS[2],t.radio_checked.alpha=0,t.radiobox&&0===t.radiobox.alpha&&(t.radiobox.alpha=1),t.bg.alpha=0})},e.prototype.clearnTween=function(){egret.Tween.removeAllTweens(),this.Tweens.forEach(function(t){return egret.Tween.removeTweens(t)}),this.Tweens.length=0},e.prototype.resetTimeProgress=function(){this.time_progress_block.forEach(function(t){t.fillColor=TIME_PPROGRESS_COLORS[1]})},e.prototype.resetTranstions=function(){this.transtions.visible&&(this.transtions.visible=!1)},e.prototype.onTiemout=function(t){this.time_progress_block[t/3]&&(this.time_progress_block[t/3].fillColor=TIME_PPROGRESS_COLORS[0])},e.prototype.showTranstions=function(t){var e=this;this.transtions.text=t,this.transtions.visible=!0;var n=this.myTween(this.transtions);return new Promise(function(t){n.to({size:60},500,egret.Ease.backInOut).to({alpha:0},500,egret.Ease.backInOut).call(function(){e.transtions.size=40,e.transtions.alpha=1,e.transtions.visible=!1,t()})})},e.prototype.showQuestion=function(){var t=this;return new Promise(function(e){return __awaiter(t,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(s){switch(s.label){case 0:t=[this.question_type,this.question_box,this.question_rule,this.question_answer],n=0,r=this.showQuestionAmin(t[n]),s.label=1;case 1:return n===t.length-1?[3,3]:[4,this.myPromise(r.then(function(){return r=i.showQuestionAmin(t[++n])}))];case 2:return s.sent(),[3,1];case 3:return e(),[2]}})})})},e.prototype.showQuestionAmin=function(t){var e=this,n=new Promise(function(n){var r=e.myTween(t);r.to({alpha:1},300,egret.Ease.circIn),r.call(function(){return n()})});return n},e.prototype.hideQuestion=function(){var t=this;return new Promise(function(e){var n=[t.question_type,t.question_box,t.question_rule,t.question_answer];n.forEach(function(e){t.myTween(e).to({alpha:0},500,egret.Ease.circOut)});var r=setTimeout(function(){e(),clearTimeout(r)},500)})},e.prototype.tapAnswerAmin=function(t){var e=this;return new Promise(function(n){var r=e.myTween(t.btn);r.to({scaleX:1.02,scaleY:1.02},200,egret.Ease.backInOut).to({scaleX:1,scaleY:1},200,egret.Ease.backInOut).call(n)})},e.prototype.errorAmin=function(){var t=this,e=this.game_window.x;return new Promise(function(n){var r=t.myTween(t.game_window);r.to({x:e-10},100,egret.Ease.cubicInOut).to({x:e+10},100,egret.Ease.cubicInOut).to({x:e-10},100,egret.Ease.cubicInOut).to({x:e},100,egret.Ease.cubicInOut).call(n)})},e.prototype.querySelector=function(t,e,n){void 0===n&&(n=!1);var r=[],i=t.$children;if(!i.length)return n?[]:void 0;for(var s=0,o=i.length;o>s;s++){if(i[s].name===e){if(!n)return i[s];r.push(i[s])}if(i[s].$children&&i[s].$children.length){var a=this.querySelector(i[s],e,n);if(n)a.length&&r.push.apply(r,a);else if(a)return a}}return n?r:void 0},e.prototype.myPromise=function(t){var e=this;return new Promise(function(n,r){return __awaiter(e,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return this.isleave&&r(),[4,t];case 1:return e=i.sent(),this.isleave&&r(),n(e),[2]}})})})},e.prototype.myTween=function(t){var e=this,n=egret.Tween.get(t);return this.Tweens.push(t),n.call(function(){var n=e.Tweens.indexOf(t);e.Tweens.splice(n,1)}),n},e}(CommonScene);__reflect(CommonGameScene.prototype,"CommonGameScene");var MessageBox=function(t){function e(){var e=t.call(this)||this;return e.event={},e}return __extends(e,t),e.prototype.childrenCreated=function(){this.left=0,this.right=0,this.top=0,this.bottom=0,this.messagebox.alpha=0,this.messagebox.scaleX=0,this.messagebox.scaleY=0,this.messagebox.y=.5*this.stage.height,this.messagebox.x=.5*this.stage.width,this.messagebox.anchorOffsetX=.5*this.messagebox.width,this.messagebox.anchorOffsetY=.5*this.messagebox.height,t.prototype.childrenCreated.call(this),this.setBackground(),this.close_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeMessage,this)},e.prototype.setBackground=function(){var t=this.messagebox,e=t.width,n=t.height,r=new eui.Image;r.width=e+20,r.height=n+20,r.x=-10,r.y=-10,r.source="message_bg_png",this.bg.addChild(r)},e.prototype.showMessage=function(){var t=this;return SceneManager.getInstance().pushScene(this),new Promise(function(e){var n=egret.Tween.get(t.messagebox);n.to({alpha:1,scaleX:1,scaleY:1},200,egret.Ease.quartIn).call(function(){return t.emit("onShow")}).call(e)})},e.prototype.closeMessage=function(){var t=this;return new Promise(function(e){var n=egret.Tween.get(t.messagebox);n.to({alpha:0,scaleX:0,scaleY:0},200,egret.Ease.quartOut).call(function(){return t.emit("onClose")}).call(function(){return SceneManager.getInstance().popScene()}).call(e)})},e.prototype.on=function(t,e){this.event[t]||(this.event[t]=[]),this.event[t].push(e)},e.prototype.once=function(t,e){var n=this;this.event[t]||(this.event[t]=[]);var r=function(){e(),n.off(t,r)};this.event[t].push(r)},e.prototype.emit=function(t){this.event[t]&&this.event[t].forEach(function(t){return t()})},e.prototype.off=function(t,e){if(this.event[t]){var n=this.event[t].indexOf(e);this.event[t].splice(n,1)}},e}(eui.Component);__reflect(MessageBox.prototype,"MessageBox",["eui.UIComponent","egret.DisplayObject"]);var matchingState={type:1,state:1,tip:"一大波儿对手正在赶来...",waittip:"已等待中:",rival:{_id:"",nickname:"",avatar:""},btnState:0,nextState:function(){return matchrResolveState}},matchrResolveState={type:1,state:2,tip:"匹配成功，对手未就绪...",waittip:"倒计时:",btnState:2,nextState:function(){return!1}},matchrReadyState={type:1,state:3,tip:"对手已就绪",waittip:"倒计时:",isrival:!0,btnState:2,nextState:function(){return!1}},selfReadyState={type:1,state:3,tip:"等待对手就绪",waittip:"倒计时:",isrival:!1,btnState:2,nextState:function(){return!1}},waitFirendsState={type:2,state:1,tip:"等待好友加入",rival:"WHO",btnState:0,nextState:function(){return waitFirendsResolveState}},waitFirendsResolveState={type:2,state:2,tip:"好友已加入",rival:"蜗牛",btnState:1,nextState:function(){return!1}},State=function(){function t(){}return t.changeState=function(e){if(t.nextState&&(t.currentState=t.nextState),t.currentState){t.handle(__assign({},t.currentState,e));var n=t.currentState.nextState();t.nextState=n?n:null}},t.currentState=null,t.nextState=null,t.handle=null,t}();__reflect(State.prototype,"State");var PkWaitTImer=function(){function t(){this.timer=null,this.time=20}return t.prototype.restTimeout=function(t){clearTimeout(this.timer),this.time=20,t.text=this.time+"秒"},t.prototype.startTimeOut=function(t,e){var n=this;this.timer=setTimeout(function(){if(0!==n.time){if(t.text=--n.time+"秒",0===n.time)return void(e&&e());n.startTimeOut(t,e)}},1e3)},t.prototype.stopTimeOut=function(){clearTimeout(this.timer)},t}();__reflect(PkWaitTImer.prototype,"PkWaitTImer");var pkWaitTimer=new PkWaitTImer,PkWaitMessageBox=function(t){function e(){var e=t.call(this)||this;return e.wait_time=0,e.disableReady=!1,e}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.user_name.text=Store.getInstance().user.nickname,this.game_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startGame,this),State.handle=this.changeState.bind(this)},e.prototype.changeState=function(t){var e=t.tip,n=t.rival,r=t.waittip,i=t.btnState,s=t.type,o=t.isrival;r&&(this.wait_time_tip.text=r);var a=this.querySelector(1===s?this.match_tip:this.join_tip,"tip");a.text=e,n&&(this.rival_name.text=n.nickname),1===s&&1===t.state&&this.startCountMatchTime(),1===s&&2===t.state?(this.ready_mask.visible=!0,clearInterval(this.count_timer),this.wait_time_text.text="20秒",pkWaitTimer.startTimeOut(this.wait_time_text,this.waitTimeout.bind(this))):1===s&&3===t.state?this.ready_mask.visible=o?!1:!0:this.ready_mask.visible=!1,this.close_btn.visible=0===i?!0:!1,this.game_btn.visible=0===i?!1:!0},e.prototype.waitTimeout=function(){pkWaitTimer.stopTimeOut(),pkWaitTimer.restTimeout(this.wait_time_text),Store.getInstance().battle.roomid="",State.currentState=matchingState,State.changeState();var t=SocketIO.getInstance().socket;setTimeout(function(){t.emit("battle",{type:"create",user_id:Store.getInstance().user._id})},2e3),this.changeBtnState(!1)},e.prototype.setType=function(t){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(n){return this.match_tip.visible=1===t?!0:!1,this.join_tip.visible=1===t?!1:!0,this.once("onShow",function(){return __awaiter(e,void 0,void 0,function(){var e,n,r=this;return __generator(this,function(i){switch(i.label){case 0:return console.log("onShow"),State.currentState=1===t?matchingState:waitFirendsState,State.changeState(),1!==t?[3,2]:(Loading.getInstance().show(),[4,SocketIO.getInstance().init()]);case 1:i.sent(),Loading.getInstance().hide(),e=SocketIO.getInstance().socket,n=Store.getInstance(),e.emit("battle",{user_id:Store.getInstance().user._id,type:"create"}),e.on("battle",function(t){if(console.log(t,"==== res ===="),"online"===t.type&&(n.battle.roomid=t.target,t.user._id!==Store.getInstance().user._id&&State.changeState({rival:t.user})),"confirm"===t.type&&(n.battle.roomid=t.target,State.nextState=t.user._id!==Store.getInstance().user._id?matchrReadyState:selfReadyState,State.changeState()),"room_created"===t.type){var e=Loading.getInstance();r.closeMessage(),e.show();var i=t.question,s=t.total_question;t.target;n.battle.current_question=i,n.battle.totle=s,setTimeout(function(){SceneManager.getInstance().pushScene(PkGameScene.getInstance()),PkGameScene.getInstance().startGame(),e.hide()},300)}}),i.label=2;case 2:return[2]}})})}),this.once("onClose",function(){clearInterval(e.count_timer),clearInterval(e.state_timer),pkWaitTimer.stopTimeOut(),pkWaitTimer.restTimeout(e.wait_time_text),State.currentState=null,State.nextState=null,e.changeBtnState(!1);var t=SocketIO.getInstance().socket;t.off("battle")}),[2]})})},e.prototype.startCountMatchTime=function(){var t=this;this.wait_time_text.text=(this.wait_time=0)+"秒",this.count_timer=setInterval(function(){t.wait_time_text.text=++t.wait_time+"秒"},1e3)},e.prototype.querySelector=function(t,e,n){void 0===n&&(n=!1);var r=[],i=t.$children;if(!i.length)return n?[]:void 0;for(var s=0,o=i.length;o>s;s++){if(i[s].name===e){if(!n)return i[s];r.push(i[s])}if(i[s].$children&&i[s].$children.length){var a=this.querySelector(i[s],e,n);if(n)a.length&&r.push.apply(r,a);else if(a)return a}}return n?r:void 0},e.prototype.changeBtnState=function(t){var e=this.querySelector(this.game_btn,"bg");t?(e.source=RES.getRes("btn_bg6_png"),this.disableReady=!0):(e.source=RES.getRes("btn_bg5_png"),this.disableReady=!1)},e.prototype.startGame=function(){if(!this.disableReady){State.currentState&&(State.currentState=null);var t=SocketIO.getInstance().socket;t.emit("battle",{type:"confirm",user_id:Store.getInstance().user._id,target:Store.getInstance().battle.roomid}),this.changeBtnState(!0)}},e}(MessageBox);__reflect(PkWaitMessageBox.prototype,"PkWaitMessageBox");var Utils=function(){function t(){}return t.ImageLoader=function(t){var e=this;return new Promise(function(n,r){var i=new egret.ImageLoader;i.crossOrigin="anonymous",i.load(t),i.once(egret.Event.COMPLETE,function(t){if(t.currentTarget.data){var e=new egret.Texture;e.bitmapData=t.currentTarget.data,n(e)}},e),i.once(egret.IOErrorEvent.IO_ERROR,function(){r()},e)})},t}();__reflect(Utils.prototype,"Utils");var BASE_URL="//mental.api.linkyee.com",Http;!function(t){function e(t,e){var n=this;return void 0===e&&(e={}),new Promise(function(r,i){var s=new egret.HttpRequest;s.responseType=egret.HttpResponseType.TEXT,s.open(BASE_URL+t,egret.HttpMethod.POST),s.setRequestHeader("Accept","application/json"),s.setRequestHeader("Content-Type","application/json");var o=Store.getInstance().user.token;o&&s.setRequestHeader("Authorization","Bearer "+Store.getInstance().user.token);Object.keys(e);s.send(JSON.stringify(e)),s.addEventListener(egret.Event.COMPLETE,function(t){var e=t.currentTarget;r(JSON.parse(e.response))},n),s.addEventListener(egret.IOErrorEvent.IO_ERROR,function(t){i(t)},n)})}function n(t){var e=this;return new Promise(function(n,r){var i=new egret.HttpRequest;i.responseType=egret.HttpResponseType.TEXT;var s=Store.getInstance().user.token;s&&i.setRequestHeader("Authorization","Bearer "+Store.getInstance().user.token),i.open(BASE_URL+t,egret.HttpMethod.GET),i.send(),i.addEventListener(egret.Event.COMPLETE,function(t){var e=t.currentTarget;n(JSON.parse(e.response))},e),i.addEventListener(egret.IOErrorEvent.IO_ERROR,function(t){r(t)},e)})}t.PostRequest=e,t.GetRequest=n}(Http||(Http={}));var SceneManager=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.scenes=[],e}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.changeScene=function(t){this.scenes.length?(this.popScene(),this.pushScene(t)):this.pushScene(t)},e.prototype.pushScene=function(t){this.scenes.push(t),this.rootLayer.addChild(t),t.onShow&&t.onShow()},e.prototype.popScene=function(){var t=this.scenes.pop();this.rootLayer.removeChild(t);var e=this.scenes[this.scenes.length-1];e&&e.onShow&&e.onShow()},e}(eui.Component);__reflect(SceneManager.prototype,"SceneManager");var SoundManager=function(){function t(){this.loadSound()}return t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.loadSound=function(){},t}();__reflect(SoundManager.prototype,"SoundManager");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,n){function r(r){e.call(n,r,t)}if(RES.hasRes(t)){var i=RES.getRes(t);i?r(i):RES.getResAsync(t,r,this)}else RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var User=function(){function t(){}return t.type=0,t.key=2,t}();__reflect(User.prototype,"User");var AboutScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.setBackBtn()},e}(CommonScene);__reflect(AboutScene.prototype,"AboutScene");var BeginScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.left=0,this.right=0,this.top=0,this.bottom=0,this.start_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toStartScence.bind(this.start_btn,!1),this.start_btn),this.nologin_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toStartScence.bind(this.start_btn,!0),this.nologin_btn)},e.prototype.toStartScence=function(t){return void 0===t&&(t=!1),__awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(r){switch(r.label){case 0:return t||(User.type=1),e=Loading.getInstance(),e.show(),[4,Http.PostRequest("/login/guest")];case 1:return n=r.sent(),e.hide(),0===n.errcode&&(Store.getInstance().user.token=n.token,SceneManager.getInstance().changeScene(StartScene.getInstance())),[2]}})})},e}(eui.Component);__reflect(BeginScene.prototype,"BeginScene",["eui.UIComponent","egret.DisplayObject"]);var ChooseTypeDetailScenen=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.setBackBtn()},e}(CommonScene);__reflect(ChooseTypeDetailScenen.prototype,"ChooseTypeDetailScenen");var ChooseTypeScene=function(t){function e(){var e=t.call(this)||this;return e.sliderIndex=0,e}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.setBackBtn(),this.type_btn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toChooseTypeDetail,this),this.loopSlider()},e.prototype.loopSlider=function(){var t=this;if(4===this.sliderIndex){this.sliderIndex=0,egret.Tween.removeTweens(this.slider);var e=egret.Tween.get(this.slider);e.to({x:0},0),this.loopSlider()}else setTimeout(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this["slider_btn"+(this.sliderIndex+1)].fillColor=0,++this.sliderIndex,this["slider_btn"+(4===this.sliderIndex?1:this.sliderIndex+1)].fillColor=16777215,[4,this.translateSlider(this.sliderIndex)];case 1:return t.sent(),this.loopSlider(),[2]}})})},1e3)},e.prototype.translateSlider=function(t){var e=this;return new Promise(function(n){console.log(t,"translateSlider",690*t);var r=egret.Tween.get(e.slider);r.to({x:-(690*t)},500).call(n)})},e.prototype.toChooseTypeDetail=function(){SceneManager.getInstance().pushScene(ChooseTypeDetailScenen.getInstance())},e}(CommonScene);__reflect(ChooseTypeScene.prototype,"ChooseTypeScene");var GameTimeout=new Timeout,answerOptions=["A","B","C","D"],GameScene=function(t){function e(){var e=t.call(this)||this;return e.current_quetion_index=1,e.player_selected=!1,e}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.setBackBtn(function(){e.reset.bind(e)(0),e.isleave=!0}),this.init()},e.prototype.init=function(){t.prototype.init.call(this),this.initAnswerBtn(this.selectAnswer.bind(this)),this.resetGameScene(),this.usekey_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.useKey,this)},e.prototype.reset=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.current_quetion_index=t,this.clearnTween(),this.resetTranstions(),[4,this.hideQuestion()];case 1:return e.sent(),GameTimeout.restTimeout(this.timeout),this.resetTimeProgress(),this.player_selected=!1,this.resetGameScene(),this.resetAnswerBtn(),this.question_index.text=t+"/"+this.questions_num,[2]}})})},e.prototype.writeQuestion=function(){var t=this.questions[this.current_quetion_index],e=t.title,n=t.options;this.question_title.text=e,this.question_answers.forEach(function(t,e){t.text.text=n[e]?n[e].text:""})},e.prototype.startGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.isleave=!1,this.setQuestions(Store.getInstance().contest.questions),[4,this.myPromise(this.reset(0))];case 1:return t.sent(),this.writeQuestion(),[4,this.myPromise(this.showTranstions("开始"))];case 2:return t.sent(),[4,this.myPromise(this.showQuestion())];case 3:return t.sent(),GameTimeout.startTimeOut(this.timeout,this.onTiemout.bind(this),this.timeoutHandle.bind(this)),[2]}})})},e.prototype.showAnswerStateAmin=function(t,e,n){var r=this,i=e===n?0:1;return t.radio.fillColor=ANSWER_RADIO_COLORS[i],t.radio_checked.fillColor=ANSWER_RADIO_COLORS[i],t.bg.fillColor=ANSWER_SELECT_COLORS[i],t.icon[i].visible=!0,new Promise(function(e){var n=r.myTween(t.radio_checked);n.to({alpha:1},100,egret.Ease.backInOut);var i=r.myTween(t.bg);i.to({alpha:1},100,egret.Ease.circIn).call(e)})},e.prototype.useKey=function(){var t=this;UseKeyMessageBox.getInstance().showMessage(),UseKeyMessageBox.getInstance().once("onClose",function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){return this.showNextQuestion(),[2]})})})},e.prototype.selectAnswer=function(t){return __awaiter(this,void 0,void 0,function(){var e,n,r,i,s=this;return __generator(this,function(o){switch(o.label){case 0:return this.player_selected?[2]:(e=Store.getInstance().contest.questions,n=answerOptions[t],this.player_selected=!0,r=this.question_answers[t],[4,this.tapAnswerAmin(r)]);case 1:return o.sent(),GameTimeout.stopTimeOut(),[4,this.checkAnswer(r,n)];case 2:return i=o.sent(),ResultMessageBox.getInstance().showMessage(),ResultMessageBox.getInstance().setSate(n===i?1:0,i,e[this.current_quetion_index].analysis),ResultMessageBox.getInstance().once("onClose",function(){return __awaiter(s,void 0,void 0,function(){return __generator(this,function(t){return this.showNextQuestion(),[2]})})}),[2]}})})},e.prototype.checkAnswer=function(t,e){return __awaiter(this,void 0,void 0,function(){var n,r,i,s,o,a=this;return __generator(this,function(c){return n=Store.getInstance().contest,r=n.round,i=n.record,s=n.id,o=n.questions,SocketIO.getInstance().socket.emit("contest",{user_id:Store.getInstance().user._id,record:i,round:r,answer:e,id:o[this.current_quetion_index]._id,type:"submit"}),[2,new Promise(function(n,r){SocketIO.getInstance().socket.once("contest",function(r){return __awaiter(a,void 0,void 0,function(){var i,s,o;return __generator(this,function(a){switch(a.label){case 0:return 0!==r.errcode?[3,4]:(i=r.is_correct,s=r.answer,o=r.credit,Store.getInstance().contest.scores.push(o),i?[3,2]:[4,this.errorAmin()]);case 1:a.sent(),a.label=2;case 2:return[4,this.showAnswerStateAmin(t,e,s)];case 3:a.sent(),n(s),a.label=4;case 4:return[2]}})})})})]})})},e.prototype.checkIsNext=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},e.prototype.showNextQuestion=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.current_quetion_index===this.questions_num-1?(this.finishGame(),[2]):[4,this.myPromise(this.reset(this.current_quetion_index+1))];case 1:return t.sent(),this.writeQuestion(),[4,this.myPromise(this.showTranstions(this.current_quetion_index===this.questions_num-1?"最后一题":"第"+NUM_MAP[this.current_quetion_index]+"题"))];case 2:return t.sent(),[4,this.myPromise(this.showQuestion())];case 3:return t.sent(),GameTimeout.startTimeOut(this.timeout,this.onTiemout.bind(this),this.timeoutHandle.bind(this)),[2]}})})},e.prototype.finishGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return GameTimeout.stopTimeOut(),[4,this.myPromise(this.hideQuestion())];case 1:return e.sent(),[4,this.myPromise(this.showTranstions("答题结束"))];case 2:return e.sent(),t=RankingResultScene.getInstance(),SceneManager.getInstance().changeScene(t),t.setScore(),[2]}})})},e.prototype.timeoutHandle=function(){var t=this,e=Store.getInstance().contest,n=e.round,r=e.record,i=(e.id,e.questions);return SocketIO.getInstance().socket.emit("contest",{user_id:Store.getInstance().user._id,record:r,round:n,answer:"",id:i[this.current_quetion_index]._id,type:"submit"}),new Promise(function(e,n){SocketIO.getInstance().socket.once("contest",function(e){return __awaiter(t,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(s){return 0===e.errcode&&(t=e.answer,n=e.credit,ResultMessageBox.getInstance().showMessage(),Store.getInstance().contest.scores.push(n),ResultMessageBox.getInstance().setSate(0,t,i[this.current_quetion_index].analysis),ResultMessageBox.getInstance().once("onClose",function(){return __awaiter(r,void 0,void 0,function(){return __generator(this,function(t){return this.showNextQuestion(),[2]})})})),[2]})})})})},e}(CommonGameScene);__reflect(GameScene.prototype,"GameScene");var NoKeyMessageBox=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(MessageBox);__reflect(NoKeyMessageBox.prototype,"NoKeyMessageBox");var ResultMessageBox=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.setSate=function(t,e,n){this.right_answer.text="答案："+e,this.analysis.text=n,this.tip_text1.visible=t?!0:!1,this.tip_text2.visible=t?!1:!0},e}(MessageBox);__reflect(ResultMessageBox.prototype,"ResultMessageBox");var UseKeyMessageBox=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(MessageBox);__reflect(UseKeyMessageBox.prototype,"UseKeyMessageBox");var PKGameTimeout=new Timeout,PkGameScene=function(t){function e(){var e=t.call(this)||this;return e.current_quetion_index=0,e.player_selected=!1,e.player_right_count=0,e.rival_right_count=0,e.result=[],e}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.setBackBtn(function(){e.reset.bind(e)(0),e.leaveGame(),e.isleave=!0}),this.init()},e.prototype.init=function(){t.prototype.init.call(this),this.initAnswerBtn(this.selectAnswer.bind(this)),this.resetGameScene(),this.score_process=this.querySelector(this.gamer_top,"score_process",!0);var e=(this.querySelector(this.gamer_top,"avater_img",!0),this.querySelector(this.gamer_top,"avater_bg",!0));this.setBackGround(e[0],[8715956,3987919],20),this.setBackGround(e[1],[15925305,3701746],20)},e.prototype.writeQuestion=function(t){var e=t.title,n=t.options;this.question_title.text=e,this.question_answers.forEach(function(t,e){t.text.text=n[e]?n[e].text:""})},e.prototype.reset=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.current_quetion_index=t,this.clearnTween(),this.resetTranstions(),0===t?[3,2]:[4,this.hideQuestion()];case 1:e.sent(),e.label=2;case 2:return this.resetGamerSelectedState(),PKGameTimeout.restTimeout(this.timeout),this.resetTimeProgress(),this.player_selected=!1,this.resetGameScene(),this.resetAnswerBtn(),this.player_right_count=0,this.rival_right_count=0,this.checkScoreProcess(),this.question_index.text=t+"/"+this.questions_num,[2]}})})},e.prototype.resetGamerSelectedState=function(){this.result=[]},e.prototype.startGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e,n,r,i,s=this;return __generator(this,function(o){switch(o.label){case 0:return t=Store.getInstance(),this.isleave=!1,this.questions_num=t.battle.totle,[4,this.myPromise(this.reset(0))];case 1:return o.sent(),this.writeQuestion(t.battle.current_question),[4,this.myPromise(this.showTranstions("开始"))];case 2:return o.sent(),[4,this.myPromise(this.showQuestion())];case 3:return o.sent(),PKGameTimeout.startTimeOut(this.timeout,this.onTiemout.bind(this),this.timeoutHandle.bind(this)),e=SocketIO.getInstance().socket,n=Loading.getInstance(),r=function(){n.show("重连中..."),SocketIO.getInstance().init()
},i=function(){n.hide(),e.emit("battle",{type:"join",target:t.battle.roomid,user_id:t.user._id})},e.on("disconnect",r),e.on("connect",i),e.on("battle",function(n){if("submit"===n.type){console.log("submit",n);var o=n.user,a=n.answer,c=n.is_correct;s.result.push({is_correct:c,answer:a,user:o}),s.setAnswerSelected(answerOptions.indexOf(a),t.user._id===o._id?"player":"rival")}if("next_question"===n.type){console.log("next_question",n);var u=n.question,h=n.result;t.battle.current_question=u,s.writeQuestion(u),s.result=h,s.checkIsNext()}if("finish"===n.type){e.off("disconnect",r),e.off("connect",i),console.log("finish",n);var h=n.result;t.battle.result=h,s.checkIsNext()}}),[2]}})})},e.prototype.showAnswerStateAmin=function(t,e){var n=this,r=0===e?0:1;return t.radio.fillColor=ANSWER_RADIO_COLORS[r],t.radio_checked.fillColor=ANSWER_RADIO_COLORS[r],t.bg.fillColor=ANSWER_SELECT_COLORS[r],t.icon[r].visible=!0,new Promise(function(e){var r=n.myTween(t.radio_checked);r.to({alpha:1},100,egret.Ease.backInOut);var i=n.myTween(t.bg);i.to({alpha:1},100,egret.Ease.circIn).call(e)})},e.prototype.selectAnswer=function(t,e){return void 0===e&&(e="player"),__awaiter(this,void 0,void 0,function(){var n,r,i;return __generator(this,function(s){switch(s.label){case 0:return n=SocketIO.getInstance().socket,r=Store.getInstance(),"player"==e&&this.player_selected?[2,!1]:("player"==e&&(this.player_selected=!0),i=this.question_answers[t],[4,this.tapAnswerAmin(i)]);case 1:return s.sent(),console.log({user_id:r.user._id,type:"submit",target:r.battle.roomid,id:r.battle.current_question._id,answer:answerOptions[t]}),n.emit("battle",{user_id:r.user._id,type:"submit",target:r.battle.roomid,id:r.battle.current_question._id,answer:answerOptions[t]}),[2]}})})},e.prototype.setAnswerSelected=function(t,e){var n=this.question_answers[t];"player"===e&&(n.radio_checked.visible=!0,n.radio_checked.alpha=1),"rival"===e&&(n.icon[2].visible=!0,n.icon[2].alpha=1)},e.prototype.checkIsNext=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.checkAnswer()];case 1:return t.sent(),this.current_quetion_index===this.questions_num-1?(this.finishGame(),[2]):(this.showNextQuestion(),[2])}})})},e.prototype.checkAnswer=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return this.result.forEach(function(e,n){t.setAnswerState(e.is_correct,e.answer,e.user._id===Store.getInstance().user._id?"player":"rival")}),this.result=[],this.checkScoreProcess(),[2,this.wait(1500)]})})},e.prototype.setAnswerState=function(t,e,n){return __awaiter(this,void 0,void 0,function(){var r,i,s=this;return __generator(this,function(o){return r=t?0:1,i=this.question_answers[answerOptions.indexOf(e)],i.bg.fillColor=ANSWER_SELECT_COLORS[r],i.bg.visible=!0,i.icon[r].visible=!0,i.radiobox.alpha=0,"player"===n&&(1===r?this.errorAmin():++this.player_right_count),"rival"===n&&0===r&&++this.rival_right_count,[2,new Promise(function(t){var e=s.myTween(i.icon[r]);e.to({alpha:1},100,egret.Ease.backInOut);var n=s.myTween(i.bg);n.to({alpha:1},100,egret.Ease.circIn).call(t)})]})})},e.prototype.checkScoreProcess=function(){var t=this;this.score_process.forEach(function(e,n){var r=t.myTween(e);r.to({width:190/t.questions_num*t[(0===n?"player":"rival")+"_right_count"]},500,egret.Ease.elasticIn)})},e.prototype.showNextQuestion=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.current_quetion_index===this.questions_num-1?(this.finishGame(),[2]):[4,this.myPromise(this.reset(this.current_quetion_index+1))];case 1:return t.sent(),[4,this.myPromise(this.showTranstions(this.current_quetion_index===this.questions_num-1?"最后一题":"第"+NUM_MAP[this.current_quetion_index]+"题"))];case 2:return t.sent(),[4,this.myPromise(this.showQuestion())];case 3:return t.sent(),PKGameTimeout.startTimeOut(this.timeout,this.onTiemout.bind(this),this.timeoutHandle.bind(this)),[2]}})})},e.prototype.finishGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this.leaveGame(),PKGameTimeout.stopTimeOut(),[4,this.myPromise(this.hideQuestion())];case 1:return e.sent(),[4,this.myPromise(this.showTranstions("答题结束"))];case 2:return e.sent(),t=PkResultScene.getInstance(),SceneManager.getInstance().changeScene(t),t.setScore(),[2]}})})},e.prototype.timeoutHandle=function(){2!==this.result.length&&(this.player_selected||this.selectAnswer(1,"player"))},e.prototype.wait=function(t){return new Promise(function(e){var n=setTimeout(function(){clearTimeout(n),e()},t)})},e.prototype.leaveGame=function(){var t=Store.getInstance(),e=SocketIO.getInstance().socket;e.emit("battle",{type:"leave",target:t.battle.roomid,user_id:t.user._id}),e.off("battle")},e}(CommonGameScene);__reflect(PkGameScene.prototype,"PkGameScene");var PkResultScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.setBackground(),this.back_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SceneManager.getInstance().changeScene(StartScene.getInstance())},this),this.play_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SceneManager.getInstance().changeScene(PkScene.getInstance()),PkGameScene.getInstance().startGame()},this)},e.prototype.setBackground=function(){var t=this.stage.stageWidth,e=this.stage.stageHeight,n=new egret.Shape,r=new egret.Matrix;r.createGradientBox(t,e,.5*Math.PI,0,0),n.graphics.beginGradientFill(egret.GradientType.LINEAR,[1495507,7534278],[1,1],[0,255],r),n.graphics.drawRect(0,0,t,e),n.graphics.endFill(),this.bg.addChild(n)},e.prototype.setScore=function(){var t=this,e=Store.getInstance(),n=e.battle.result,r=null,i=null;n.result.forEach(function(t){t.user._id===e.user._id?r=t:i=t}),this.user_name.text=r.user.nickname,Utils.ImageLoader(r.user.avatar).then(function(e){t.user_avatar.source=e}),this.rival_name.text=i.user.nickname,Utils.ImageLoader(i.user.avatar).then(function(e){t.rival_avatar.source=e});var s={win:{result_top:"pk_result2_png",user_result_bg:"pk_user_bg2_left_png",user_result_status:"pk_status2_left_png",rival_result_bg:"pk_user_bg2_right_png",rival_result_status:"pk_status3_right_png"},lost:{result_top:"pk_result3_png",user_result_bg:"pk_user_bg3_left_png",user_result_status:"pk_status3_left_png",rival_result_bg:"pk_user_bg3_right_png",rival_result_status:"pk_status2_right_png"},tie:{result_top:"pk_result1_png",user_result_bg:"pk_user_bg1_left_png",user_result_status:"pk_status1_left_png",rival_result_bg:"pk_user_bg1_right_png",rival_result_status:"pk_status1_right_png"}},o=null;r.credit>i.credit?o=s.win:r.credit<i.credit?o=s.lost:r.credit===i.credit&&(o=s.tie),Object.keys(o).forEach(function(e){RES.getResAsync(""+o[e]).then(function(n){t[e].source=n})}),this.credit.text="10",this.money.text=n.result[0].money.toLocaleString(),this.user_score.text=n.result[0].credit+"积分",this.other_score.text=n.result[1].credit+"积分"},e}(CommonScene);__reflect(PkResultScene.prototype,"PkResultScene");var PkScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.setBackBtn(),this.setBackground(),this.user_name.text=Store.getInstance().user.nickname,this.pk_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showPkWait.bind(this,1),this),this.share_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showPkWait.bind(this,2),this)},e.prototype.setBackground=function(){var t=this.stage.stageWidth,e=this.stage.stageHeight,n=new egret.Shape,r=new egret.Matrix;r.createGradientBox(t,e,.5*Math.PI,0,0),n.graphics.beginGradientFill(egret.GradientType.LINEAR,[1495507,7534278],[1,1],[0,255],r),n.graphics.drawRect(0,0,t,e),n.graphics.endFill(),this.bg.addChild(n)},e.prototype.showPkWait=function(t){var e=PkWaitMessageBox.getInstance();e.showMessage(),e.setType(t)},e}(CommonScene);__reflect(PkScene.prototype,"PkScene");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="resource/game_skins/Loading.exml",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.left=0,this.right=0,this.top=0,this.bottom=0},e.prototype.createView=function(){},e.prototype.onProgress=function(t,e){var n=t/e;this.progress.value=100*n},e}(eui.Component);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var RankingItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toGameScene,this)},e.prototype.dataChanged=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];1===this.data.level&&(this.item_mask.visible=!1),1!==this.data.level&&"disabled"===this.data.status&&(this.item_mask.visible=!0,this.nopass.visible=!0),this.pass.visible=!1},e.prototype.toGameScene=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return 1!==this.data.level&&"disabled"===this.data.status?[2]:(Loading.getInstance().show(),[4,Http.PostRequest("/level/contest",{level:this.data._id})]);case 1:return t=e.sent(),0===t.errcode&&(Store.getInstance().contest=__assign({levelId:this.data._id,scores:[]},t.contest),Loading.getInstance().hide(),SceneManager.getInstance().pushScene(GameScene.getInstance()),GameScene.getInstance().startGame()),[2]}})})},e}(eui.ItemRenderer);__reflect(RankingItem.prototype,"RankingItem");var RankingListScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.setBackground(),this.setBackBtn()},e.prototype.onShow=function(){this.loadRankingListView()},e.prototype.setBackground=function(){var t=this.stage.stageWidth,e=this.stage.stageHeight,n=new egret.Shape,r=new egret.Matrix;r.createGradientBox(t,e,.5*Math.PI,0,0),n.graphics.beginGradientFill(egret.GradientType.LINEAR,[1495507,7534278],[1,1],[0,255],r),n.graphics.drawRect(0,0,t,e),n.graphics.endFill(),this.bg.addChild(n)},e.prototype.getRankingData=function(){var t=this;return new Promise(function(e){return __awaiter(t,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return Loading.getInstance().show(),[4,Http.GetRequest("/levels")];case 1:return t=n.sent(),Loading.getInstance().hide(),e(0===t.errcode?t.levels:[]),[2]}})})})},e.prototype.loadRankingListView=function(){return __awaiter(this,void 0,void 0,function(){var t,e,n,r,i;return __generator(this,function(s){switch(s.label){case 0:return t=this.ranking_view,[4,this.getRankingData()];case 1:return e=s.sent(),n=new eui.ArrayCollection(e),r=new eui.DataGroup,i=new eui.VerticalLayout,i.gap=30,r.layout=i,r.dataProvider=n,r.percentWidth=100,r.percentHeight=100,r.itemRenderer=RankingItem,r.useVirtualLayout=!0,t.viewport=r,[2]}})})},e}(CommonScene);__reflect(RankingListScene.prototype,"RankingListScene");var RankingResultScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.setBackground(),this.back_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SceneManager.getInstance().changeScene(StartScene.getInstance())},this),this.play_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.again,this)},e.prototype.setScore=function(){var t=this,e=Store.getInstance().contest,n=e.round,r=e.record,i=e.scores;[1,1,1,1,1,1].forEach(function(e,n){t["score"+(n+1)].text=i[n]?"+"+i[n]:0}),Loading.getInstance().show(),SocketIO.getInstance().socket.emit("contest",{user_id:Store.getInstance().user._id,record:r,round:n,type:"finish"}),SocketIO.getInstance().socket.once("contest",function(e){if(0===e.errcode){var n=e.credit,r=e.money;t.credit.text="+"+n.toLocaleString(),t.money.text="+"+r.toLocaleString()}}),Loading.getInstance().hide()},e.prototype.again=function(){return __awaiter(this,void 0,void 0,function(){var t,e,n,r,i;return __generator(this,function(s){switch(s.label){case 0:return t=Store.getInstance().contest.levelId,Loading.getInstance().show(),[4,Http.PostRequest("/level/contest",{leve:t})];case 1:return e=s.sent(),0===e.errcode&&(n=e.contest,r=n.round,i=n.questions,Store.getInstance().contest.scores=[],Store.getInstance().contest.round=r,Store.getInstance().contest.questions=i,Loading.getInstance().hide(),SceneManager.getInstance().pushScene(GameScene.getInstance()),GameScene.getInstance().startGame()),[2]}})})},e.prototype.setBackground=function(){var t=750,e=1334,n=new egret.Shape,r=new egret.Matrix;r.createGradientBox(t,e,.5*Math.PI,0,0),n.graphics.beginGradientFill(egret.GradientType.LINEAR,[1495507,7534278],[1,1],[0,255],r),n.graphics.drawRect(0,0,t,e),n.graphics.endFill(),this.bg.addChild(n)},e}(CommonScene);__reflect(RankingResultScene.prototype,"RankingResultScene");var RankItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];console.log(this.data.credit,"this.data.credit ",this.data.rank,"rank",this.data),this.data.rank&&-1===this.data.rank&&(this.credit.text="暂无",this.rank_num.text="99+"),this.data.rank&&(this.rank_num.text=this.data.rank),this.rank_num.text=this.data.index},e}(eui.ItemRenderer);__reflect(RankItem.prototype,"RankItem");var RANKLIST_NUM=2,RankList=function(){function t(){this.list=[],this.data=null,this.load=!1}return t}();__reflect(RankList.prototype,"RankList",["RankList"]);var RankScene=function(t){function e(){var e=t.call(this)||this;return e.current_show_rank=null,e.rank1_list=new RankList,e.rank2_list=new RankList,e.isloading=!1,e}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){for(t.prototype.childrenCreated.call(this),this.setBackBtn(),e=1;RANKLIST_NUM>=e;e++)this["tab"+e+"_btn"].addEventListener(egret.TouchEvent.TOUCH_TAP,this.selectBtn.bind(this,e),this);return this.loadRankListView(1),[2]})})},e.prototype.getRankData=function(t,e){return console.log("getRankData",e),new Promise(function(n){for(var r=[],i=1;t>=i;i++)r.push({rank:i,name:e?e:"测试用户",score:1e3});setTimeout(function(){n(r)},0)})},e.prototype.loadRankListView=function(t){return __awaiter(this,void 0,void 0,function(){var e,n,r,i,s;return __generator(this,function(o){switch(o.label){case 0:return e=this["rank"+t+"_view"],n=this["rank"+t+"_list"],n.load?(this.setShowRankView(e,n.data,n.list,t),[2]):(this.showLoading(!0),[4,[,this.get7DayData,this.getTop50Data][t].bind(this)()]);case 1:return r=o.sent(),n.load=!0,i=new eui.ArrayCollection(r),n.data=i,s=new eui.DataGroup,s.dataProvider=i,s.percentWidth=100,s.percentHeight=100,s.itemRenderer=RankItem,s.useVirtualLayout=!0,n.list=s,this.showLoading(!1),this.setShowRankView(e,i,s,t),[2]}})})},e.prototype.setShowRankView=function(t,e,n,r){this.current_show_rank&&(this.current_show_rank.view.visible=!1),this.current_show_rank={view:t,data:e,index:r},this.current_show_rank.view.visible=!0,t.viewport=n},e.prototype.selectBtn=function(t){if(!this.isloading&&!this.isloading){var e=this.current_show_rank.index;console.log(this["tab"+e+"_btn"].getChildAt(0),this["tab"+t+"_btn"].getChildAt(0)),this["tab"+e+"_btn"].getChildAt(0).fillColor=TAB_BTN_COLORS[1],this["tab"+t+"_btn"].getChildAt(0).fillColor=TAB_BTN_COLORS[0],this.loadRankListView(t)}},e.prototype.showLoading=function(t){this.current_show_rank&&(this.current_show_rank.view.visible=!1),this.isloading=t,this.loading.visible=t},e.prototype.get7DayData=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,Http.GetRequest("/top/7d")];case 1:return t=e.sent(),0===t.errcode?(this.setSelfRank([t.my]),[2,t.top?t.top.map(function(t,e){return t.rank=e+1}):[]]):[2,[]]}})})},e.prototype.getTop50Data=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,Http.GetRequest("/top/50")];case 1:return t=e.sent(),0===t.errcode?(this.setSelfRank([t.my]),[2,t.top?t.top.map(function(t,e){return t.rank=e+1}):[]]):[2,[]]}})})},e.prototype.setSelfRank=function(t){return __awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(r){return e=new eui.ArrayCollection(t),n=new eui.DataGroup,n.dataProvider=e,n.percentWidth=100,n.percentWidth=100,n.itemRenderer=RankItem,this.self_rank.$children.length&&this.self_rank.removeChild(this.self_rank.$children[0]),this.self_rank.addChild(n),[2]})})},e.prototype.pullDownLoad=function(t){var e=this["rank"+t+"_view"],n=e.viewport,r=n.scrollV,i=n.contentHeight,s=n.height;if(r+s===i){console.log("scroll bottom");var o=new eui.Label;o.text="加载中",this.current_show_rank.data.addItem({isloading:!0})}console.log("=== scroll end ===")},e}(CommonScene);__reflect(RankScene.prototype,"RankScene");var ServiceScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.setBackBtn()},e}(CommonScene);__reflect(ServiceScene.prototype,"ServiceScene");var BuySuccessMessage=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(MessageBox);__reflect(BuySuccessMessage.prototype,"BuySuccessMessage");var ExchangeItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.exchange_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showExchangeMessage,this)},e.prototype.showExchangeMessage=function(){ExchangeSuccesMessage.getInstance().showMessage()},e}(eui.ItemRenderer);__reflect(ExchangeItem.prototype,"ExchangeItem");var ExchangeSuccesMessage=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(MessageBox);__reflect(ExchangeSuccesMessage.prototype,"ExchangeSuccesMessage");var ShoppingItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.buy_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showBuyMessage,this)},e.prototype.showBuyMessage=function(){BuySuccessMessage.getInstance().showMessage()},e}(eui.ItemRenderer);__reflect(ShoppingItem.prototype,"ShoppingItem");var SHOPPING_TAB_NUM=2,TAB_BTN_COLORS=[9588976,12094968],DataList=function(){function t(){this.list=[],this.data=null,this.load=!1}return t}();__reflect(DataList.prototype,"DataList",["DataList"]);var ShoppingMallScene=function(t){function e(){var e=t.call(this)||this;return e.current_show_tab=null,e.shopping1_list=new DataList,e.shopping2_list=new DataList,e.isloading=!1,e}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.setBackBtn(),this.setBackground();for(var e=1;SHOPPING_TAB_NUM>=e;e++)this["tab"+e+"_btn"].addEventListener(egret.TouchEvent.TOUCH_TAP,this.selectBtn.bind(this,e),this);this.loadShoppingListView(1)},e.prototype.getShoppingListData=function(t,e){return console.log("getRankData",e),new Promise(function(n){for(var r=[],i=1;t>i;i++)r.push({rank:i,name:e?e:"测试用户",score:1e3});setTimeout(function(){n(r)},0)})},e.prototype.getKeyList=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,Http.GetRequest("/gift/key")];case 1:return t=e.sent(),0===t.errcode?(console.log(this,"this"),this.setUserInfo(t.user),[2,t.gift?[t.gift]:[]]):[2,[]]}})})},e.prototype.getGiftsList=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,Http.GetRequest("/gifts")];case 1:return t=e.sent(),0===t.errcode?(console.log(this,"this"),this.setUserInfo(t.user),[2,t.gifts?t.gifts:[]]):[2,[]]}})})},e.prototype.getMyGift=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,Http.GetRequest("/my_gift")];case 1:return t=e.sent(),0===t.errcode?[2,t.list?t.list:[]]:[2,[]]}})})},e.prototype.setUserInfo=function(t){var e=t.money,n=t.nickname;t.avatar;this.user_momey.text=e.toLocaleString(),this.user_name.text=n},e.prototype.loadShoppingListView=function(t){return __awaiter(this,void 0,void 0,function(){var e,n,r,i,s,o;return __generator(this,function(a){switch(a.label){case 0:return e=this["shopping"+t+"_view"],n=this["shopping"+t+"_list"],n.load?(this.setShowTabView(e,n.data,n.list,t),[2]):(r=[ShoppingItem,ExchangeItem],this.showLoading(!0),[4,[,this.getKeyList,this.getGiftsList,this.getMyGift][t].bind(this)()]);case 1:return i=a.sent(),this.getShoppingListData(20,t),n.load=!0,s=new eui.ArrayCollection(i),n.data=s,o=new eui.DataGroup,o.dataProvider=s,o.percentWidth=100,o.percentHeight=100,o.itemRenderer=r[t-1],o.useVirtualLayout=!0,n.list=o,this.showLoading(!1),this.setShowTabView(e,s,o,t),[2]}})})},e.prototype.setShowTabView=function(t,e,n,r){this.current_show_tab&&(this.current_show_tab.view.visible=!1),this.current_show_tab={view:t,data:e,index:r},this.current_show_tab.view.visible=!0,t.viewport=n},e.prototype.selectBtn=function(t){if(!this.isloading){var e=this.current_show_tab.index;console.log(this["tab"+e+"_btn"].getChildAt(0),this["tab"+t+"_btn"].getChildAt(0)),this["tab"+e+"_btn"].getChildAt(0).fillColor=TAB_BTN_COLORS[1],this["tab"+t+"_btn"].getChildAt(0).fillColor=TAB_BTN_COLORS[0],this.loadShoppingListView(t)}},e.prototype.showLoading=function(t){this.current_show_tab&&(this.current_show_tab.view.visible=!1),this.isloading=t,this.loading.visible=t},e.prototype.setBackground=function(){var t=this.stage.stageWidth,e=this.stage.stageHeight,n=new egret.Shape,r=new egret.Matrix;r.createGradientBox(t,e,.5*Math.PI,0,0),n.graphics.beginGradientFill(egret.GradientType.LINEAR,[1495507,7534278],[1,1],[0,255],r),n.graphics.drawRect(0,0,t,e),n.graphics.endFill(),this.bg.addChild(n)},e}(CommonScene);__reflect(ShoppingMallScene.prototype,"ShoppingMallScene");var LevelUpMessageBox=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.left=0,this.right=0,this.top=0,this.bottom=0},e}(MessageBox);__reflect(LevelUpMessageBox.prototype,"LevelUpMessageBox");var LoginInMessageBox=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(MessageBox);__reflect(LoginInMessageBox.prototype,"LoginInMessageBox");var StartScene=function(t){function e(){var e=t.call(this)||this;return e.init=!1,e}return __extends(e,t),e.getInstance=function(){return e.shared||(e.shared=new e),e.shared},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){0===User.type&&(this.menu_item_4.visible=!1,this.menu_warp.scrollPolicyV="off"),t.prototype.childrenCreated.call(this),Loading.getInstance().show(),setTimeout(function(){Loading.getInstance().hide()},2e3),LoginInMessageBox.getInstance().showMessage();var e=new eui.HorizontalLayout;e.horizontalAlign=egret.HorizontalAlign.JUSTIFY,this.bottom_nav.layout=e,this.menu_item_1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toRankingList,this),this.menu_item_2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toPK,this),this.menu_item_3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toYB,this),this.push_key_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toShoppingMail,this),this.bottom_nav_1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toRank,this),this.bottom_nav_2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toShoppingMail,this),this.bottom_nav_3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toService,this),this.bottom_nav_4.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toAbout,this)},e.prototype.onShow=function(){return __awaiter(this,void 0,void 0,function(){var t,e,n,r,i,s,o,a=this;return __generator(this,function(c){switch(c.label){case 0:return Loading.getInstance().show(),[4,Http.GetRequest("/home")];case 1:return t=c.sent(),0===t.errcode&&(e=t.user,n=e.money,r=e.credit,i=e.nickname,s=e.avatar,o=e.key_count,Store.getInstance().user=__assign({},t.user,Store.getInstance().user),this.init||Utils.ImageLoader(s).then(function(t){a.user_avatar.source=t}),this.user_name.text=i,this.user_keys.text=o+"/5",this.money.text=n.toLocaleString(),this.credit.text=r.toLocaleString(),this.init=!0),Loading.getInstance().hide(),[2]}})})},e.prototype.toRankingList=function(){SceneManager.getInstance().pushScene(RankingListScene.getInstance())},e.prototype.toYB=function(){SceneManager.getInstance().pushScene(ChooseTypeScene.getInstance())},e.prototype.toPK=function(){SceneManager.getInstance().pushScene(PkScene.getInstance())},e.prototype.toShoppingMail=function(){SceneManager.getInstance().pushScene(ShoppingMallScene.getInstance())},e.prototype.toRank=function(){SceneManager.getInstance().pushScene(RankScene.getInstance())},e.prototype.toAbout=function(){SceneManager.getInstance().pushScene(AboutScene.getInstance())},e.prototype.toService=function(){SceneManager.getInstance().pushScene(ServiceScene.getInstance())},e}(CommonScene);__reflect(StartScene.prototype,"StartScene");var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadResource()];case 1:return n.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return t=n.sent(),[4,platform.login()];case 3:return n.sent(),[4,platform.getUserInfo()];case 4:return e=n.sent(),console.log(e),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,this.loadTheme()];case 2:return n.sent(),t=new LoadingUI,this.addChild(t),[4,RES.loadGroup("preload",0,t)];case 3:return n.sent(),this.removeChild(t),[3,5];case 4:return e=n.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,n){var r=new eui.Theme("resource/default.thm.json",t.stage);r.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return SceneManager.getInstance().rootLayer=this,SceneManager.getInstance().changeScene(BeginScene.getInstance()),[2]})})},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var Loading=function(){function t(){this.loading=document.querySelector(".loading"),this.loading_text=this.loading.querySelector(".text")}return t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.show=function(t){t?this.loading_text.innerText=t:this.loading_text.innerText="加载中",this.loading.style.display="flex"},t.prototype.hide=function(){this.loading.style.display="none"},t}();__reflect(Loading.prototype,"Loading");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,n,r){function i(t){e.call(r,t)}function s(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),n.call(r))}var o=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,n){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(r,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var a=t.split("/");a.pop();var c=a.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(r,generateJSON.paths[t])},this):RES.getResByUrl(c,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){e.call(r,generateJSON.paths[t])},o)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var SocketIO=function(){function t(){this.needConnect=!0}return t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t.prototype.init=function(){var t=this;return new Promise(function(e){t.needConnect?(t.connect(),t.socket.once("disconnect",function(){console.log("disconnect"),t.needConnect=!0
}),t.socket.once("connect",function(){console.log("connect"),t.needConnect=!1,e()})):e()})},t.prototype.connect=function(){this.socket=io.connect("ws://mental.api.linkyee.com",{hostname:"mental.api.linkyee.com",path:"/socket.io",port:"80",secure:!1,transports:["websocket"]})},t}();__reflect(SocketIO.prototype,"SocketIO");var WxSDK=function(){function t(){var t=new BodyConfig;t.appId="此处填写公共平台appID，未认证的ID将不能使用自定义分享等接口，请联系微信官方获取",t.debug=!0,t.jsApiList=["checkJsApi","onMenuShareAppMessage","onMenuShareTimeline"],wx&&(wx.config(t),wx.ready(function(){var t="",e="",n=location.href,r=new BodyMenuShareAppMessage;r.title=t,r.desc=e,r.link=n,wx.onMenuShareTimeline(r);var i=new BodyMenuShareTimeline;i.title=t,i.link=n,wx.onMenuShareTimeline(i)}))}return t.prototype.getWxConfig=function(){},t}();__reflect(WxSDK.prototype,"WxSDK");var Store=function(){function t(){this.contest={},this.user={},this.battle={roomid:"",current_question:null,totle:0,result:null}}return t.getInstance=function(){return t.shared||(t.shared=new t),t.shared},t}();__reflect(Store.prototype,"Store");